<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Test - Fault Scenario 1 Simulation</title>
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>
  <div class="worksheet-box">
    <h1>Fault Scenario 1 Simulation Test</h1>
    
    <!-- Interactive Simulation Section -->
    <div class="worksheet-section simulation-section">
      <h2 class="section-header"><i class="fas fa-cogs"></i> Interactive Temperature Control Simulation</h2>
      <div class="simulation-container">
        <div class="simulation-header">
          <h3><i class="fas fa-thermometer-half"></i> Tank Temperature Control System</h3>
          <p>Experience the fault scenario in real-time. Observe how the temperature offset affects system behavior and practice troubleshooting techniques.</p>
        </div>
        
        <div class="simulation-grid">
          <div class="simulation-left">
            <div class="temperature-visualization">
              <h4>Temperature Display</h4>
              <div class="temp-display-container">
                <div class="temp-gauge-container">
                  <div id="temp-gauge" class="temp-gauge">
                    <div class="gauge-background"></div>
                    <div class="gauge-fill" id="gauge-fill"></div>
                    <div class="gauge-center">
                      <div class="temp-value" id="displayed-temp">75°C</div>
                      <div class="temp-label">Displayed</div>
                    </div>
                  </div>
                </div>
                <div class="temp-indicators">
                  <div class="temp-indicator">
                    <span class="indicator-label">Actual Temperature:</span>
                    <span class="indicator-value" id="actual-temp">80°C</span>
                  </div>
                  <div class="temp-indicator">
                    <span class="indicator-label">Setpoint:</span>
                    <span class="indicator-value" id="setpoint-temp">75°C</span>
                  </div>
                  <div class="temp-indicator">
                    <span class="indicator-label">Offset Applied:</span>
                    <span class="indicator-value" id="offset-value">+5°C</span>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="system-status">
              <h4>System Status</h4>
              <div class="status-grid-sim">
                <div class="status-item-sim">
                  <span class="status-label-sim">Alarm Status:</span>
                  <span class="status-value-sim normal" id="alarm-status">NORMAL</span>
                </div>
                <div class="status-item-sim">
                  <span class="status-label-sim">Quality Issues:</span>
                  <span class="status-value-sim warning" id="quality-status">YES</span>
                </div>
                <div class="status-item-sim">
                  <span class="status-label-sim">Cooling Load:</span>
                  <span class="status-value-sim warning" id="cooling-status">HIGH</span>
                </div>
                <div class="status-item-sim">
                  <span class="status-label-sim">Energy Usage:</span>
                  <span class="status-value-sim warning" id="energy-status">+25%</span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="simulation-right">
            <div class="control-panel">
              <h4>Control Panel</h4>
              <div class="control-group">
                <label for="offset-control">Temperature Offset:</label>
                <input type="range" id="offset-control" min="-10" max="10" value="5" step="0.5">
                <span id="offset-display">+5.0°C</span>
              </div>
              <div class="control-group">
                <label for="setpoint-control">Setpoint:</label>
                <input type="range" id="setpoint-control" min="60" max="90" value="75" step="1">
                <span id="setpoint-display">75°C</span>
              </div>
              <div class="control-buttons">
                <button id="reset-offset" class="control-btn">Reset Offset</button>
                <button id="apply-changes" class="control-btn">Apply Changes</button>
                <button id="reset-simulation" class="control-btn">Reset Simulation</button>
              </div>
            </div>
            
            <div class="troubleshooting-tools">
              <h4>Troubleshooting Tools</h4>
              <div class="tool-buttons">
                <button id="check-offset" class="tool-btn-sim">Check Offset</button>
                <button id="use-thermometer" class="tool-btn-sim">Use Thermometer</button>
                <button id="review-reports" class="tool-btn-sim">Review Reports</button>
                <button id="adjust-offset" class="tool-btn-sim">Adjust Offset</button>
              </div>
            </div>
            
            <div class="diagnostic-log">
              <h4>Diagnostic Log</h4>
              <div id="log-container" class="log-container">
                <div class="log-entry">System initialized with +5°C offset</div>
                <div class="log-entry">Actual temperature: 80°C, Displayed: 75°C</div>
                <div class="log-entry">Quality issues detected in recent batches</div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="simulation-instructions">
          <h4>Instructions</h4>
          <ol>
            <li>Observe the temperature display showing 75°C while the actual temperature is 80°C</li>
            <li>Use the troubleshooting tools to investigate the issue</li>
            <li>Adjust the offset control to see how it affects the displayed vs actual temperature</li>
            <li>Try to resolve the issue by removing the offset</li>
            <li>Monitor the system status indicators for changes</li>
          </ol>
        </div>
      </div>
    </div>
  </div>

  <style>
    /* Simulation Styles */
    .simulation-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin: 20px 0;
    }
    
    .simulation-left, .simulation-right {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .temperature-visualization {
      background: #333;
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid #2196F3;
    }
    
    .temperature-visualization h4 {
      color: #2196F3;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .temp-display-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }
    
    .temp-gauge-container {
      position: relative;
      width: 200px;
      height: 200px;
    }
    
    .temp-gauge {
      position: relative;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: conic-gradient(from 0deg, #4CAF50 0deg, #4CAF50 180deg, #666 180deg, #666 360deg);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }
    
    .gauge-background {
      position: absolute;
      width: 80%;
      height: 80%;
      border-radius: 50%;
      background: #222;
    }
    
    .gauge-fill {
      position: absolute;
      width: 80%;
      height: 80%;
      border-radius: 50%;
      background: conic-gradient(from 0deg, #FF5722 0deg, #FF5722 180deg, transparent 180deg, transparent 360deg);
      transition: all 0.5s ease;
    }
    
    .gauge-center {
      position: relative;
      z-index: 2;
      text-align: center;
      color: #FFFFFF;
    }
    
    .temp-value {
      font-size: 24px;
      font-weight: bold;
      color: #FFFFFF;
    }
    
    .temp-label {
      font-size: 12px;
      color: #AAA;
      margin-top: 5px;
    }
    
    .temp-indicators {
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 100%;
    }
    
    .temp-indicator {
      display: flex;
      justify-content: space-between;
      padding: 8px 12px;
      background: #444;
      border-radius: 4px;
    }
    
    .indicator-label {
      color: #AAA;
      font-weight: bold;
    }
    
    .indicator-value {
      color: #FFFFFF;
      font-weight: bold;
    }
    
    .system-status {
      background: #333;
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid #FF9800;
    }
    
    .system-status h4 {
      color: #FF9800;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .status-grid-sim {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    
    .status-item-sim {
      display: flex;
      justify-content: space-between;
      padding: 8px 12px;
      background: #444;
      border-radius: 4px;
    }
    
    .status-label-sim {
      color: #AAA;
      font-weight: bold;
    }
    
    .status-value-sim {
      color: #FFFFFF;
      font-weight: bold;
    }
    
    .status-value-sim.normal {
      color: #4CAF50;
    }
    
    .status-value-sim.warning {
      color: #FF9800;
    }
    
    .status-value-sim.error {
      color: #F44336;
    }
    
    .control-panel {
      background: #333;
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid #4CAF50;
    }
    
    .control-panel h4 {
      color: #4CAF50;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .control-group {
      margin-bottom: 15px;
    }
    
    .control-group label {
      display: block;
      color: #FFFFFF;
      margin-bottom: 5px;
      font-weight: bold;
    }
    
    .control-group input[type="range"] {
      width: 100%;
      margin-bottom: 5px;
    }
    
    .control-group span {
      color: #2196F3;
      font-weight: bold;
      font-size: 14px;
    }
    
    .control-buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 15px;
    }
    
    .control-btn {
      background: #2196F3;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    
    .control-btn:hover {
      background: #1976D2;
      transform: translateY(-2px);
    }
    
    .troubleshooting-tools {
      background: #333;
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid #9C27B0;
    }
    
    .troubleshooting-tools h4 {
      color: #9C27B0;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .tool-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    
    .tool-btn-sim {
      background: #9C27B0;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    
    .tool-btn-sim:hover {
      background: #7B1FA2;
      transform: translateY(-1px);
    }
    
    .tool-btn-sim:disabled {
      background: #666;
      cursor: not-allowed;
      transform: none;
    }
    
    .diagnostic-log {
      background: #333;
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid #607D8B;
    }
    
    .diagnostic-log h4 {
      color: #607D8B;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .log-container {
      background: #222;
      border: 1px solid #555;
      border-radius: 4px;
      padding: 10px;
      height: 120px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
    }
    
    .log-entry {
      color: #4CAF50;
      margin-bottom: 5px;
      padding: 2px 0;
    }
    
    .log-entry.warning {
      color: #FF9800;
    }
    
    .log-entry.error {
      color: #F44336;
    }
    
    .log-entry.info {
      color: #2196F3;
    }
    
    .simulation-instructions {
      background: #333;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
      border-left: 4px solid #FF5722;
    }
    
    .simulation-instructions h4 {
      color: #FF5722;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .simulation-instructions ol {
      color: #FFFFFF;
      padding-left: 20px;
    }
    
    .simulation-instructions li {
      margin-bottom: 8px;
      line-height: 1.4;
    }
    
    @media (max-width: 768px) {
      .simulation-grid {
        grid-template-columns: 1fr;
        gap: 20px;
      }
      
      .status-grid-sim {
        grid-template-columns: 1fr;
      }
      
      .tool-buttons {
        grid-template-columns: 1fr;
      }
    }
  </style>

  <script>
    // Simulation data
    let simulationData = {
      actualTemperature: 80,
      displayedTemperature: 75,
      setpoint: 75,
      offset: 5,
      qualityIssues: true,
      coolingLoad: 'HIGH',
      energyUsage: '+25%',
      alarmStatus: 'NORMAL'
    };

    // Simulation Functions
    function initializeSimulation() {
      console.log('Initializing Temperature Control Simulation');
      
      // Initialize controls
      const offsetControl = document.getElementById('offset-control');
      const setpointControl = document.getElementById('setpoint-control');
      const offsetDisplay = document.getElementById('offset-display');
      const setpointDisplay = document.getElementById('setpoint-display');
      
      // Set initial values
      offsetControl.value = simulationData.offset;
      setpointControl.value = simulationData.setpoint;
      updateOffsetDisplay();
      updateSetpointDisplay();
      
      // Add event listeners
      offsetControl.addEventListener('input', function() {
        simulationData.offset = parseFloat(this.value);
        updateOffsetDisplay();
        updateSimulation();
      });
      
      setpointControl.addEventListener('input', function() {
        simulationData.setpoint = parseInt(this.value);
        updateSetpointDisplay();
        updateSimulation();
      });
      
      // Button event listeners
      document.getElementById('reset-offset').addEventListener('click', resetOffset);
      document.getElementById('apply-changes').addEventListener('click', applyChanges);
      document.getElementById('reset-simulation').addEventListener('click', resetSimulation);
      
      // Tool event listeners
      document.getElementById('check-offset').addEventListener('click', () => useSimulationTool('check-offset'));
      document.getElementById('use-thermometer').addEventListener('click', () => useSimulationTool('use-thermometer'));
      document.getElementById('review-reports').addEventListener('click', () => useSimulationTool('review-reports'));
      document.getElementById('adjust-offset').addEventListener('click', () => useSimulationTool('adjust-offset'));
      
      // Initial update
      updateSimulation();
    }

    function updateOffsetDisplay() {
      const offsetDisplay = document.getElementById('offset-display');
      const offset = simulationData.offset;
      offsetDisplay.textContent = `${offset >= 0 ? '+' : ''}${offset.toFixed(1)}°C`;
    }

    function updateSetpointDisplay() {
      const setpointDisplay = document.getElementById('setpoint-display');
      setpointDisplay.textContent = `${simulationData.setpoint}°C`;
    }

    function updateSimulation() {
      // Update displayed temperature (actual - offset)
      simulationData.displayedTemperature = simulationData.actualTemperature - simulationData.offset;
      
      // Update displays
      document.getElementById('displayed-temp').textContent = `${simulationData.displayedTemperature}°C`;
      document.getElementById('actual-temp').textContent = `${simulationData.actualTemperature}°C`;
      document.getElementById('setpoint-temp').textContent = `${simulationData.setpoint}°C`;
      document.getElementById('offset-value').textContent = `${simulationData.offset >= 0 ? '+' : ''}${simulationData.offset}°C`;
      
      // Update gauge
      updateTemperatureGauge();
      
      // Update status indicators
      updateStatusIndicators();
    }

    function updateTemperatureGauge() {
      const gaugeFill = document.getElementById('gauge-fill');
      const displayedTemp = simulationData.displayedTemperature;
      
      // Calculate gauge fill percentage (assuming range 60-90°C)
      const minTemp = 60;
      const maxTemp = 90;
      const percentage = Math.max(0, Math.min(100, ((displayedTemp - minTemp) / (maxTemp - minTemp)) * 100));
      
      // Update gauge fill
      gaugeFill.style.background = `conic-gradient(from 0deg, #FF5722 0deg, #FF5722 ${percentage * 3.6}deg, transparent ${percentage * 3.6}deg, transparent 360deg)`;
    }

    function updateStatusIndicators() {
      const displayedTemp = simulationData.displayedTemperature;
      const actualTemp = simulationData.actualTemperature;
      const setpoint = simulationData.setpoint;
      
      // Update quality status based on temperature deviation
      const tempDeviation = Math.abs(actualTemp - setpoint);
      const qualityStatus = document.getElementById('quality-status');
      if (tempDeviation > 3) {
        qualityStatus.textContent = 'YES';
        qualityStatus.className = 'status-value-sim warning';
      } else {
        qualityStatus.textContent = 'NO';
        qualityStatus.className = 'status-value-sim normal';
      }
      
      // Update cooling load based on actual temperature
      const coolingStatus = document.getElementById('cooling-status');
      if (actualTemp > setpoint + 2) {
        coolingStatus.textContent = 'HIGH';
        coolingStatus.className = 'status-value-sim warning';
      } else {
        coolingStatus.textContent = 'NORMAL';
        coolingStatus.className = 'status-value-sim normal';
      }
      
      // Update energy usage
      const energyStatus = document.getElementById('energy-status');
      if (actualTemp > setpoint + 2) {
        energyStatus.textContent = '+25%';
        energyStatus.className = 'status-value-sim warning';
      } else {
        energyStatus.textContent = 'NORMAL';
        energyStatus.className = 'status-value-sim normal';
      }
    }

    function resetOffset() {
      simulationData.offset = 0;
      document.getElementById('offset-control').value = 0;
      updateOffsetDisplay();
      updateSimulation();
      addLogEntry('Offset reset to 0°C', 'info');
    }

    function applyChanges() {
      addLogEntry('Changes applied to system', 'info');
      addLogEntry(`New offset: ${simulationData.offset >= 0 ? '+' : ''}${simulationData.offset}°C`, 'info');
      addLogEntry(`New setpoint: ${simulationData.setpoint}°C`, 'info');
    }

    function resetSimulation() {
      simulationData = {
        actualTemperature: 80,
        displayedTemperature: 75,
        setpoint: 75,
        offset: 5,
        qualityIssues: true,
        coolingLoad: 'HIGH',
        energyUsage: '+25%',
        alarmStatus: 'NORMAL'
      };
      
      document.getElementById('offset-control').value = 5;
      document.getElementById('setpoint-control').value = 75;
      updateOffsetDisplay();
      updateSetpointDisplay();
      updateSimulation();
      
      // Clear log
      const logContainer = document.getElementById('log-container');
      logContainer.innerHTML = `
        <div class="log-entry">System initialized with +5°C offset</div>
        <div class="log-entry">Actual temperature: 80°C, Displayed: 75°C</div>
        <div class="log-entry">Quality issues detected in recent batches</div>
      `;
      
      addLogEntry('Simulation reset to initial state', 'info');
    }

    function useSimulationTool(toolId) {
      const button = document.getElementById(toolId);
      button.disabled = true;
      
      switch(toolId) {
        case 'check-offset':
          addLogEntry('Checking controller offset settings...', 'info');
          setTimeout(() => {
            addLogEntry(`Current offset: ${simulationData.offset >= 0 ? '+' : ''}${simulationData.offset}°C`, 'info');
            addLogEntry('Offset was applied as temporary fix', 'warning');
            button.disabled = false;
          }, 1000);
          break;
          
        case 'use-thermometer':
          addLogEntry('Using portable thermometer...', 'info');
          setTimeout(() => {
            addLogEntry(`Actual temperature: ${simulationData.actualTemperature}°C`, 'info');
            addLogEntry(`Displayed temperature: ${simulationData.displayedTemperature}°C`, 'info');
            addLogEntry(`Difference: ${simulationData.offset >= 0 ? '+' : ''}${simulationData.offset}°C`, 'warning');
            button.disabled = false;
          }, 1000);
          break;
          
        case 'review-reports':
          addLogEntry('Reviewing quality reports...', 'info');
          setTimeout(() => {
            addLogEntry('Product quality: Degraded (Last 3 batches)', 'warning');
            addLogEntry('Temperature trend: Increasing over time', 'warning');
            addLogEntry('Cooling system load: 85% (Normal: 40-60%)', 'warning');
            button.disabled = false;
          }, 1000);
          break;
          
        case 'adjust-offset':
          addLogEntry('Adjusting temperature offset...', 'info');
          setTimeout(() => {
            addLogEntry('Recommended: Gradually reduce offset to 0°C', 'info');
            addLogEntry('Monitor actual temperature during adjustment', 'info');
            addLogEntry('Verify system stabilizes at setpoint', 'info');
            button.disabled = false;
          }, 1000);
          break;
      }
    }

    function addLogEntry(message, type = 'info') {
      const logContainer = document.getElementById('log-container');
      const logEntry = document.createElement('div');
      logEntry.className = `log-entry ${type}`;
      logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logContainer.appendChild(logEntry);
      logContainer.scrollTop = logContainer.scrollHeight;
    }

    // Initialize simulation when page loads
    document.addEventListener('DOMContentLoaded', function() {
      initializeSimulation();
    });
  </script>
</body>
</html> 