<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-BMDTX8B88C"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-BMDTX8B88C');
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Matrix TSL - Fault Scenario 6: River Bridge Waste Company</title>
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="icon" type="image/x-icon" href="assets/icons/matrix-icon.ico">    <script src="worksheet-core.js"></script>
<script src="worksheet-tracking.js"></script>
<script src="shared-components.js"></script>

</head>
<body>
  <!-- Navigation -->
  <nav class="main-navigation">
    <div class="nav-container">
      <div class="nav-logo">
        <img src="assets/matrix-logo.png" alt="Matrix Logo">
      </div>
      <ul class="nav-menu">
        <li class="nav-item">
          <a href="#" onclick="window.location='index.html'" class="nav-link">
            <i class="fas fa-home"></i> HOME
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='cp0539-worksheets.html'" class="nav-link">
            <i class="fas fa-cogs"></i> CP0539
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='cp6773-worksheets.html'" class="nav-link active">
            <i class="fas fa-exclamation-triangle"></i> CP6773
          </a>
        </li>
        
        <li class="nav-item">
          <a href="#" onclick="window.location='tracking-dashboard.html'" class="nav-link">
            <i class="fas fa-chart-line"></i> PROGRESS
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='about.html'" class="nav-link">
            <i class="fas fa-info-circle"></i> ABOUT
          </a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="worksheet-box">
    <!-- Integrated Worksheet Header -->
    <div class="worksheet-header">
      <div class="worksheet-header-content">
        <div class="worksheet-header-left">
          <button class="worksheet-nav-btn worksheet-back-btn" onclick="window.location.href='fault-scenario-5.html'">
            <i class="fas fa-arrow-left"></i>
            <span>Previous Scenario</span>
          </button>
        </div>
        <div class="worksheet-header-center">
          <h1 class="worksheet-title">Fault Scenario 6 - River Bridge Waste Company</h1>
        </div>
        <div class="worksheet-header-right">
          <button class="worksheet-nav-btn worksheet-next-btn" onclick="window.location.href='fault-scenario-7.html'">
            <span>Next Scenario</span>
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>
    <!-- Introduction Section -->
    <div class="worksheet-section introduction-section">
      <h2 class="section-header"><i class="fas fa-info-circle"></i> Fault Scenario 6: River Bridge Waste Company</h2>
      <div class="worksheet-content">
        <div class="scenario-info">
          <div class="info-grid">
            <div class="info-item">
              <strong>Company:</strong> River Bridge Waste Company
            </div>
            <div class="info-item">
              <strong>Process:</strong> Wastewater treatment system
            </div>
            <div class="info-item">
              <strong>Shift:</strong> First day on the job
            </div>
            <div class="info-item">
              <strong>Urgency:</strong> High - System keeps shutting down randomly
            </div>
            <div class="info-item">
              <strong>Difficulty:</strong> Advanced
            </div>
            <div class="info-item">
              <strong>Time:</strong> 30-40 minutes
            </div>
          </div>
        </div>

                <div class="background-section">
          <div class="background-text">
            <div class="scenario-description">
              <h3>Background</h3>
              <p>You start your first day on the job at River Bridge Waste Company and their wastewater system is in bad shape. The maintenance guys are all mechanical and you're electrical biased so it's now your job to fix things.</p>
              
              <p>They've recently swapped out a broken PLC module, repaired the Estop and fixed the temperature sensor wiring. They've said the float switches need to be replaced at some point.</p>
              
              <p>Even with those repairs, the system keeps shutting down randomly. It's just happened again, please help.</p>
            </div>
          </div>
          
          <div class="background-image">
            <img src="assets/scenarios/sterilizer.png" alt="Wastewater Treatment System">
            <figcaption>Wastewater Treatment System - Environmental Compliance</figcaption>
          </div>
        </div>

        <div class="system-overview">
          <h3>System Status</h3>
          <div class="status-grid">
            <div class="status-item">
              <span class="status-label">System Operation:</span>
              <span class="status-value error">SHUT DOWN</span>
            </div>
            <div class="status-item">
              <span class="status-label">EStop LED:</span>
              <span class="status-value error" id="estop-led">ON</span>
            </div>
            <div class="status-item">
              <span class="status-label">EStop Channel 1:</span>
              <span class="status-value">ON</span>
            </div>
            <div class="status-item">
              <span class="status-label">EStop Channel 2:</span>
              <span class="status-value">OFF</span>
            </div>
            <div class="status-item">
              <span class="status-label">Tank High Float Switch [NC]:</span>
              <span class="status-value">ON</span>
            </div>
            <div class="status-item">
              <span class="status-label">Tank Low Float Switch [NO]:</span>
              <span class="status-value">ON</span>
            </div>
            <div class="status-item">
              <span class="status-label">PLC Module:</span>
              <span class="status-value">RECENTLY REPLACED</span>
            </div>
            <div class="status-item">
              <span class="status-label">Emergency Stop:</span>
              <span class="status-value">RECENTLY REPAIRED</span>
            </div>
            <div class="status-item">
              <span class="status-label">Temperature Sensor:</span>
              <span class="status-value">RECENTLY FIXED</span>
            </div>
            <div class="status-item">
              <span class="status-label">Float Switches:</span>
              <span class="status-value warning">NEED REPLACEMENT</span>
            </div>
            <div class="status-item">
              <span class="status-label">Shutdown Pattern:</span>
              <span class="status-value error">RANDOM</span>
            </div>
            <div class="status-item">
              <span class="status-label">Environmental Compliance:</span>
              <span class="status-value error">AT RISK</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Troubleshooting Tips Section -->
    <div class="worksheet-section objectives-section">
      <h2 class="section-header"><i class="fas fa-lightbulb"></i> Troubleshooting Tips</h2>
      <div class="worksheet-content">
        <ul class="objectives-list">
          <li>Check for loose electrical connections and poor wiring quality</li>
          <li>Inspect float switch condition and electrical integrity</li>
          <li>Verify PLC module installation and configuration</li>
          <li>Test emergency stop circuit and safety interlocks</li>
        </ul>
      </div>
    </div>

    <!-- Interactive Tools Section - Commented out as requested -->
    <!-- <div class="worksheet-section tools-section">
      <h2 class="section-header"><i class="fas fa-tools"></i> Investigation Tools</h2>
      <div class="worksheet-content">
        <div class="tools-grid">
          <div class="tool-card" onclick="useTool('check_electrical_connections')">
            <i class="fas fa-plug"></i>
            <h3>Check Electrical Connections</h3>
            <p>Inspect for loose connections and poor wiring quality</p>
          </div>
          <div class="tool-card" onclick="useTool('test_float_switches')">
            <i class="fas fa-toggle-on"></i>
            <h3>Test Float Switches</h3>
            <p>Check float switch condition and electrical integrity</p>
          </div>
          <div class="tool-card" onclick="useTool('verify_plc_installation')">
            <i class="fas fa-microchip"></i>
            <h3>Verify PLC Installation</h3>
            <p>Check PLC module installation and configuration</p>
          </div>
          <div class="tool-card" onclick="useTool('test_emergency_stop')">
            <i class="fas fa-stop-circle"></i>
            <h3>Test Emergency Stop</h3>
            <p>Check emergency stop circuit and safety interlocks</p>
          </div>
        </div>
        <div id="tool-results" class="tool-results"></div>
      </div>
    </div> -->

    <!-- Simulation Section - COMMENTED OUT
    <div class="worksheet-section simulation-section">
      <h2 class="section-header"><i class="fas fa-cogs"></i> System Simulation</h2>
      <div class="worksheet-content">
        <div id="steam-sterilization-simulation" class="simulation-container">
          <div class="simulation-loading">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Loading steam sterilization simulation...</p>
          </div>
        </div>
        <div id="hmi-panel" class="simulation-container" style="margin-top: 20px;"></div>
        <div id="plc-io-panel" class="simulation-container" style="margin-top: 20px;"></div>
        <div id="fault-injection-panel" class="simulation-panel" style="margin-top: 20px;"></div>
        <div id="diagnostic-challenges-panel" class="simulation-panel" style="margin-top: 20px;"></div>
      </div>
    </div>
    -->

    <!-- Analysis Section -->
    <div class="worksheet-section questions-section">
      <h2 class="section-header"><i class="fas fa-clipboard-list"></i> Fault Analysis Worksheet</h2>
      <div class="questions-content">
        <div class="analysis-section">
          <h4>Observations:</h4>
          <textarea class="answer-input" data-question="observations" placeholder="Record your observations of the system behavior, readings, and any unusual indicators..."></textarea>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer('observations')">Save Observations</button>
          </div>
        </div>
        
        <div class="analysis-section">
          <h4>Problem:</h4>
          <textarea class="answer-input" data-question="problem" placeholder="Identify the root cause and describe the specific problem affecting the system..."></textarea>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer('problem')">Save Problem Analysis</button>
          </div>
        </div>
        
        <div class="analysis-section">
          <h4>Solution:</h4>
          <textarea class="answer-input" data-question="solution" placeholder="Describe the steps you would take to resolve the issue safely and effectively..."></textarea>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer('solution')">Save Solution</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Simulation Scripts - COMMENTED OUT
  <script src="hmi-simulation.js"></script>
  <script src="plc-simulation.js"></script>
  <script src="valve-simulation.js"></script>
  <script src="pump-simulation.js"></script>
  -->
  <script>
    // Tool usage tracking
    let toolResults = {};
    
    function useTool(toolId) {
      const toolData = {
        'check_electrical_connections': {
          title: 'Electrical Connections Analysis',
          content: 'Multiple loose electrical connections found throughout the system. Terminal blocks show signs of corrosion and poor contact. Several wire connections are barely making contact, causing intermittent system shutdowns.',
          icon: 'fas fa-plug'
        },
        'test_float_switches': {
          title: 'Float Switch Test Results',
          content: 'Float switches show severe corrosion and electrical degradation. Switch contacts are intermittent and unreliable. The switches are sending false signals to the PLC, causing random system shutdowns.',
          icon: 'fas fa-toggle-on'
        },
        'verify_plc_installation': {
          title: 'PLC Installation Verification',
          content: 'PLC module installation appears correct, but the module is receiving intermittent signals from corroded float switches. The PLC is responding to false shutdown signals from the degraded switches.',
          icon: 'fas fa-microchip'
        },
        'test_emergency_stop': {
          title: 'Emergency Stop Circuit Test',
          content: 'Emergency stop circuit is functioning correctly after recent repair. The issue is not with the E-stop but with the float switch signals causing the PLC to initiate shutdown sequences.',
          icon: 'fas fa-stop-circle'
        }
      };
      
      const result = toolData[toolId];
      if (result) {
        toolResults[toolId] = result;
        displayToolResult(toolId, result);
      }
    }
    
    function displayToolResult(toolId, result) {
      const resultsDiv = document.getElementById('tool-results');
      const resultHtml = `
        <div class="tool-result" id="result-${toolId}">
          <div class="result-header">
            <i class="${result.icon}"></i>
            <h3>${result.title}</h3>
          </div>
          <div class="result-content">
            <p>${result.content}</p>
          </div>
        </div>
      `;
      resultsDiv.innerHTML += resultHtml;
    }
    
    // Submit answer
    function submitAnswer(questionType) {
      const input = document.querySelector(`[data-question="${questionType}"]`);
      const answer = input.value.trim();
      
      if (answer) {
        // Save to local storage for backward compatibility
        localStorage.setItem(`fault6_${questionType}`, answer);
        
        // Track with the tracking system if available
        if (typeof trackFaultScenarioAnswer === 'function') {
          trackFaultScenarioAnswer(questionType, answer);
        }
        
        const button = event.target;
        const originalText = button.textContent;
        button.textContent = 'Saved!';
        button.style.background = '#4CAF50';
        
        setTimeout(() => {
          button.textContent = originalText;
        }, 2000);
      } else {
        alert('Please enter content before saving.');
      }
    }

    // Load saved answers
    function loadSavedAnswers() {
      const questionTypes = ['observations', 'problem', 'solution'];
      const worksheetId = 6;
      const type = 'fault';

      // Try new tracking system format first
      if (typeof worksheetTracker !== 'undefined') {
        const progress = worksheetTracker.getWorksheetProgress(worksheetId, type);
        if (progress.answers && Object.keys(progress.answers).length > 0) {
          questionTypes.forEach((questionType, index) => {
            const questionNumber = index + 1; // Convert to 1-based numbering
            const answerData = progress.answers[questionNumber];
            if (answerData) {
              const answerValue = typeof answerData === 'object' ? answerData.value : answerData;
              const input = document.querySelector(`[data-question="${questionType}"]`);
              if (input && answerValue) {
                input.value = answerValue;
              }
            }
          });
          return; // Don't check old format if new format has data
        }
      }

      // Fall back to old format if new format doesn't exist
      questionTypes.forEach(questionType => {
        const saved = localStorage.getItem(`fault6_${questionType}`);
        if (saved) {
          const input = document.querySelector(`[data-question="${questionType}"]`);
          if (input) {
            input.value = saved;
          }
        }
      });
    }
    
    // Load saved answers on page load
    document.addEventListener('DOMContentLoaded', function() {
      loadSavedAnswers();
      startEstopLedFlashing(); // Start EStop LED flashing
    });

    // EStop LED flashing function
    function startEstopLedFlashing() {
      const estopLed = document.getElementById('estop-led');
      let isOn = true;
      
      setInterval(() => {
        if (isOn) {
          estopLed.textContent = 'OFF';
          estopLed.className = 'status-value';
        } else {
          estopLed.textContent = 'ON';
          estopLed.className = 'status-value error';
        }
        isOn = !isOn;
      }, 500); // Flash every 500ms (twice per second)
    }
  </script>
</body>
</html> 

