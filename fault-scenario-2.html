<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-BMDTX8B88C"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-BMDTX8B88C');
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Matrix TSL - Fault Scenario 2: Pharmaceutical Flow System</title>
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="icon" type="image/x-icon" href="assets/icons/matrix-icon.ico">    <script src="worksheet-core.js"></script>
<script src="worksheet-tracking.js"></script>
<script src="shared-components.js"></script>

</head>
<body>
  <!-- Navigation -->
  <nav class="main-navigation">
    <div class="nav-container">
      <div class="nav-logo" onclick="window.location='index.html'" title="Go to Home">
        <img src="assets/matrix-logo.png" alt="Matrix Logo">
      </div>
      <ul class="nav-menu">
        <li class="nav-item">
          <a href="#" onclick="window.location='index.html'" class="nav-link">
            <i class="fas fa-home"></i> HOME
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='cp0539-worksheets.html'" class="nav-link">
            <i class="fas fa-cogs"></i> CP0539
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='cp6773-worksheets.html'" class="nav-link active">
            <i class="fas fa-exclamation-triangle"></i> CP6773
          </a>
        </li>
        
        <li class="nav-item">
          <a href="#" onclick="window.location='tracking-dashboard.html'" class="nav-link">
            <i class="fas fa-chart-line"></i> PROGRESS
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='about.html'" class="nav-link">
            <i class="fas fa-info-circle"></i> ABOUT
          </a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="worksheet-box">
    <!-- Integrated Worksheet Header -->
    <div class="worksheet-header">
      <div class="worksheet-header-content">
        <div class="worksheet-header-left">
          <button class="worksheet-nav-btn worksheet-back-btn" onclick="window.location.href='fault-scenario-1.html'">
            <i class="fas fa-arrow-left"></i>
            <span>Previous Scenario</span>
          </button>
        </div>
        <div class="worksheet-header-center">
          <h1 class="worksheet-title">Fault Scenario 2 - Pharmaceutical Flow System</h1>
        </div>
        <div class="worksheet-header-right">
          <button class="worksheet-nav-btn worksheet-next-btn" onclick="window.location.href='fault-scenario-3.html'">
            <span>Next Scenario</span>
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>
    <!-- Introduction Section -->
    <div class="worksheet-section introduction-section">
      <h2 class="section-header"><i class="fas fa-info-circle"></i> Fault Scenario 2: Pharmaceutical Flow System</h2>
      <div class="worksheet-content">
        <div class="scenario-info">
          <div class="info-grid">
            <div class="info-item">
              <strong>Company:</strong> Pharmaceutical Manufacturing Plant
            </div>
            <div class="info-item">
              <strong>Process:</strong> Sterile IV solution production
            </div>
            <div class="info-item">
              <strong>Shift:</strong> Production shift maintenance
            </div>
            <div class="info-item">
              <strong>Urgency:</strong> High - System keeps shutting down
            </div>
            <div class="info-item">
              <strong>Difficulty:</strong> Intermediate
            </div>
            <div class="info-item">
              <strong>Time:</strong> 20-30 minutes
            </div>
          </div>
        </div>

        <div class="background-section">
          <div class="background-text">
            <div class="scenario-description">
              <h3>Background</h3>
              <p>You work in a pharmaceutical plant producing sterile IV solutions, the process tank is fitted with sensors to ensure the lid and ports are properly secured to prevent contamination. The system will not operate if any sensor or the tank lid is removed, as the environment is not vacuum sealed and the fluid could become contaminated. Currently, the system starts briefly but shuts down after a few seconds each time. This older system has no alarm or fault display.</p>
            </div>
          </div>
          
          <div class="background-image">
            <img src="assets/scenarios/pharma-cleanroom.png" alt="Pharmaceutical Flow System">
            <figcaption>Pharmaceutical Flow System - Sterile Liquid Production</figcaption>
          </div>
        </div>

        <div class="system-overview">
          <h3>System Status</h3>
          <div class="status-grid">
            <div class="status-item">
              <span class="status-label">System Operation:</span>
              <span class="status-value error">STARTS THEN SHUTS DOWN</span>
            </div>
            <div class="status-item">
              <span class="status-label">Run Time:</span>
              <span class="status-value warning">4 SECONDS</span>
            </div>
            <div class="status-item">
              <span class="status-label">Tank Lid Sensor:</span>
              <span class="status-value" id="tank-lid-sensor">SECURE</span>
            </div>
            <div class="status-item">
              <span class="status-label">Safety System:</span>
              <span class="status-value warning">CONTAMINATION PREVENTION</span>
            </div>
            <div class="status-item">
              <span class="status-label">Production Status:</span>
              <span class="status-value error">BLOCKED</span>
            </div>
            <div class="status-item">
              <span class="status-label">Environment:</span>
              <span class="status-value warning">NOT VACUUM SEALED</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Troubleshooting Tips Section -->
    <div class="worksheet-section objectives-section">
      <h2 class="section-header"><i class="fas fa-lightbulb"></i> Troubleshooting Tips</h2>
      <div class="worksheet-content">
        <ul class="objectives-list">
          <li>Check tank lid sensor for proper connection and secure mounting</li>
          <li>Inspect all port sensors for contamination prevention system</li>
          <li>Verify sensor wiring and electrical connections</li>
          <li>Test safety interlock system functionality</li>
          <li>Check for loose or damaged sensor hardware</li>
        </ul>
      </div>
    </div>

    <!-- Interactive Tools Section - Commented out as requested -->
    <!-- <div class="worksheet-section tools-section">
      <h2 class="section-header"><i class="fas fa-tools"></i> Investigation Tools</h2>
      <div class="worksheet-content">
        <div class="tools-grid">
          <div class="tool-card" onclick="useTool('check_pump_performance')">
            <i class="fas fa-tachometer-alt"></i>
            <h3>Check Pump Performance</h3>
            <p>Analyze pump efficiency and mechanical condition</p>
          </div>
          <div class="tool-card" onclick="useTool('inspect_flow_system')">
            <i class="fas fa-water"></i>
            <h3>Inspect Flow System</h3>
            <p>Check for blockages and flow restrictions</p>
          </div>
          <div class="tool-card" onclick="useTool('test_flow_sensor')">
            <i class="fas fa-microchip"></i>
            <h3>Test Flow Sensor</h3>
            <p>Verify sensor accuracy and calibration</p>
          </div>
          <div class="tool-card" onclick="useTool('check_system_pressure')">
            <i class="fas fa-gauge-high"></i>
            <h3>Check System Pressure</h3>
            <p>Monitor pressure differentials and system performance</p>
          </div>
        </div>
        <div id="tool-results" class="tool-results"></div>
      </div>
    </div> -->

    <!-- Investigation Results Section -->
    <div class="worksheet-section results-section" id="investigation-results" style="display: none;">
      <h2 class="section-header"><i class="fas fa-clipboard-list"></i> Investigation Results</h2>
      <div class="results-content" id="results-content">
        <!-- Results will be populated by JavaScript -->
      </div>
    </div>

    <!-- Analysis Section -->
    <div class="worksheet-section questions-section">
      <h2 class="section-header"><i class="fas fa-clipboard-list"></i> Fault Analysis Worksheet</h2>
      <div class="questions-content">
        <div class="analysis-section">
          <h4>Observations:</h4>
          <textarea class="answer-input" data-question="observations" placeholder="Record your observations of the system behavior, readings, and any unusual indicators..."></textarea>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer('observations')">Save Observations</button>
          </div>
        </div>
        
        <div class="analysis-section">
          <h4>Problem:</h4>
          <textarea class="answer-input" data-question="problem" placeholder="Identify the root cause and describe the specific problem affecting the system..."></textarea>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer('problem')">Save Problem Analysis</button>
          </div>
        </div>
        
        <div class="analysis-section">
          <h4>Solution:</h4>
          <textarea class="answer-input" data-question="solution" placeholder="Describe the steps you would take to resolve the issue safely and effectively..."></textarea>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer('solution')">Save Solution</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Styles -->
  <style>
    .scenario-info {
      background: #333;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
    }
    
    .info-item {
      color: #FFFFFF;
      padding: 10px;
      background: #444;
      border-radius: 4px;
    }
    
    .scenario-description {
      background: #333;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .scenario-description h3 {
      color: #4CAF50;
      margin-bottom: 15px;
    }
    
    .scenario-description p {
      color: #FFFFFF;
      margin-bottom: 15px;
      line-height: 1.6;
    }
    
    .system-overview {
      background: #333;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .system-overview h3 {
      color: #4CAF50;
      margin-bottom: 15px;
    }
    
    .status-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }
    
    .status-item {
      display: flex;
      justify-content: space-between;
      padding: 10px;
      background: #444;
      border-radius: 4px;
    }
    
    .status-label {
      color: #AAA;
      font-weight: bold;
    }
    
    .status-value {
      color: #FFFFFF;
      font-weight: bold;
    }
    
    .status-value.normal {
      color: #4CAF50;
    }
    
    .status-value.warning {
      color: #FF9800;
    }
    
    .status-value.error {
      color: #F44336;
    }
    
    .system-diagram {
      text-align: center;
      margin: 20px 0;
    }
    
    .system-diagram img {
      max-width: 400px;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    
    .system-diagram figcaption {
      color: #FFFFFF;
      margin-top: 10px;
      font-style: italic;
    }
    
    .objectives-list {
      list-style: none;
      padding: 0;
    }
    
    .objectives-list li {
      color: #FFFFFF;
      padding: 10px 0;
      border-bottom: 1px solid #555;
      position: relative;
      padding-left: 30px;
    }
    
    .objectives-list li:before {
      content: "✓";
      color: #4CAF50;
      font-weight: bold;
      position: absolute;
      left: 0;
    }
    
    .tools-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }
    
    .tool-card {
      background: #333;
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid #2196F3;
    }
    
    .tool-card h4 {
      color: #2196F3;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .tool-card p {
      color: #FFFFFF;
      margin-bottom: 15px;
    }
    
    .tool-btn {
      background: #2196F3;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }
    
    .tool-btn:hover {
      background: #1976D2;
    }
    
    .tool-btn:disabled {
      background: #666;
      cursor: not-allowed;
    }
    
    .question-item, .analysis-section {
      background: #333;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
    }
    
    .question-item h4, .analysis-section h4 {
      color: #FFFFFF;
      margin-bottom: 10px;
      font-size: 16px;
      font-weight: bold;
    }
    
    .analysis-section h4 {
      color: #4CAF50;
      border-bottom: 2px solid #4CAF50;
      padding-bottom: 5px;
    }
    
    .answer-input {
      width: 100%;
      height: 100px;
      padding: 10px;
      border: 1px solid #555;
      border-radius: 4px;
      background: #222;
      color: #FFFFFF;
      resize: vertical;
    }
    
    .submit-question-btn {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
    }
    
    .submit-question-btn:hover {
      background: #45a049;
    }
  </style>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  
  <script>
    // Tool usage tracking
    let toolResults = {};
    
    function useTool(toolId) {
      const toolData = {
        'check_pump_performance': {
          title: 'Pump Performance Analysis',
          content: 'Pump efficiency test shows 65% efficiency (normal is 85%). Motor current is 12.5A (normal is 8.2A), indicating mechanical wear. Pump impeller shows signs of cavitation damage. Pump is running at full speed but delivering only 30% of rated flow.',
          icon: 'fas fa-tachometer-alt'
        },
        'inspect_flow_system': {
          title: 'Flow System Inspection Results',
          content: 'Visual inspection reveals partial blockage in main supply line. Pressure differential across filter shows 2.8 bar (normal is 0.5 bar). Filter element is 90% clogged with pharmaceutical residue. Flow restriction is causing pump to work against high backpressure.',
          icon: 'fas fa-water'
        },
        'test_flow_sensor': {
          title: 'Flow Sensor Test Results',
          content: 'Flow sensor calibration check shows sensor is accurate within ±2%. Sensor output matches actual flow conditions. No sensor malfunction detected. Low flow reading is confirmed by manual flow measurement.',
          icon: 'fas fa-microchip'
        },
        'check_system_pressure': {
          title: 'System Pressure Analysis',
          content: 'Inlet pressure: 1.2 bar (normal). Outlet pressure: 4.0 bar (elevated). Pressure differential: 2.8 bar (normal is 1.5 bar). High backpressure indicates system restriction, not pump failure. Pressure relief valve is operating correctly.',
          icon: 'fas fa-gauge-high'
        }
      };
      
      const result = toolData[toolId];
      if (result) {
        toolResults[toolId] = result;
        displayToolResult(toolId, result);
      }
    }
    
    function displayToolResult(toolId, result) {
      const resultsDiv = document.getElementById('tool-results');
      const resultHtml = `
        <div class="tool-result" id="result-${toolId}">
          <div class="result-header">
            <i class="${result.icon}"></i>
            <h3>${result.title}</h3>
          </div>
          <div class="result-content">
            <p>${result.content}</p>
          </div>
        </div>
      `;
      resultsDiv.innerHTML += resultHtml;
    }



    // Submit answer
    function submitAnswer(questionType) {
      const input = document.querySelector(`[data-question="${questionType}"]`);
      const answer = input.value.trim();
      
      if (answer) {
        // Save to local storage for backward compatibility
        localStorage.setItem(`fault2_${questionType}`, answer);
        
        // Track with the tracking system if available
        if (typeof trackFaultScenarioAnswer === 'function') {
          trackFaultScenarioAnswer(questionType, answer);
        }
        
        const button = event.target;
        const originalText = button.textContent;
        button.textContent = 'Saved!';
        button.style.background = '#4CAF50';
        
        setTimeout(() => {
          button.textContent = originalText;
        }, 2000);
      } else {
        alert('Please enter content before saving.');
      }
    }

    // Load saved answers
    function loadSavedAnswers() {
      const questionTypes = ['observations', 'problem', 'solution'];
      const worksheetId = 2;
      const type = 'fault';

      // Try new tracking system format first
      if (typeof worksheetTracker !== 'undefined') {
        const progress = worksheetTracker.getWorksheetProgress(worksheetId, type);
        if (progress.answers && Object.keys(progress.answers).length > 0) {
          questionTypes.forEach((questionType, index) => {
            const questionNumber = index + 1; // Convert to 1-based numbering
            const answerData = progress.answers[questionNumber];
            if (answerData) {
              const answerValue = typeof answerData === 'object' ? answerData.value : answerData;
              const input = document.querySelector(`[data-question="${questionType}"]`);
              if (input && answerValue) {
                input.value = answerValue;
              }
            }
          });
          return; // Don't check old format if new format has data
        }
      }

      // Fall back to old format if new format doesn't exist
      questionTypes.forEach(questionType => {
        const saved = localStorage.getItem(`fault2_${questionType}`);
        if (saved) {
          const input = document.querySelector(`[data-question="${questionType}"]`);
          if (input) {
            input.value = saved;
          }
        }
      });
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      loadSavedAnswers();
      initializeEducationalNote();
      
      // Tank lid sensor blinking functionality
      function updateTankLidSensor() {
        const sensorElement = document.getElementById('tank-lid-sensor');
        if (sensorElement) {
          // Toggle between SECURE and LOOSE
          if (sensorElement.textContent === 'SECURE') {
            sensorElement.textContent = 'LOOSE';
            sensorElement.className = 'status-value error';
          } else {
            sensorElement.textContent = 'SECURE';
            sensorElement.className = 'status-value';
          }
        }
      }
      
      // Start the tank lid sensor blinking every 5 seconds
      setInterval(updateTankLidSensor, 5000);
    });
  </script>
</body>
</html> 
