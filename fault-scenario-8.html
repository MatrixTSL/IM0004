<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Matrix TSL - Fault Scenario 8: Chemical Reactor pH Control System</title>
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="icon" type="image/x-icon" href="assets/icons/matrix-icon.ico">    <script src="worksheet-core.js"></script>
<script src="worksheet-tracking.js"></script>

</head>
<body>
  <!-- Navigation -->
  <nav class="main-navigation">
    <div class="nav-container">
      <div class="nav-logo">
        <img src="assets/matrix-logo.png" alt="Matrix Logo">
      </div>
      <ul class="nav-menu">
        <li class="nav-item">
          <a href="#" onclick="window.location='index.html'" class="nav-link">
            <i class="fas fa-home"></i> HOME
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='cp0539-worksheets.html'" class="nav-link">
            <i class="fas fa-cogs"></i> CP0539
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='cp6773-worksheets.html'" class="nav-link active">
            <i class="fas fa-exclamation-triangle"></i> CP6773
          </a>
        </li>
        
        <li class="nav-item">
          <a href="#" onclick="window.location='tracking-dashboard.html'" class="nav-link">
            <i class="fas fa-chart-line"></i> PROGRESS
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='about.html'" class="nav-link">
            <i class="fas fa-info-circle"></i> ABOUT
          </a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="worksheet-box">
    <!-- Integrated Worksheet Header -->
    <div class="worksheet-header">
      <div class="worksheet-header-content">
        <div class="worksheet-header-left">
          <button class="worksheet-nav-btn worksheet-back-btn" onclick="window.location.href='fault-scenario-7.html'">
            <i class="fas fa-arrow-left"></i>
            <span>Previous Scenario</span>
          </button>
        </div>
        <div class="worksheet-header-center">
          <h1 class="worksheet-title">Fault Scenario 8 - Chemical Reactor pH Control System</h1>
        </div>
        <div class="worksheet-header-right">
          <button class="worksheet-nav-btn worksheet-next-btn" onclick="window.location.href='cp6773-worksheets.html'">
            <span>Back to Fault Scenarios</span>
            <i class="fas fa-list"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Introduction Section -->
    <div class="worksheet-section introduction-section">
      <h2 class="section-header"><i class="fas fa-info-circle"></i> Scenario Overview</h2>
      <div class="worksheet-content">
        <div class="scenario-info">
          <div class="info-grid">
            <div class="info-item">
              <strong>Company:</strong> ChemTech Processing Solutions
            </div>
            <div class="info-item">
              <strong>Process:</strong> Chemical neutralization reactor
            </div>
            <div class="info-item">
              <strong>Shift:</strong> Day shift production
            </div>
            <div class="info-item">
              <strong>Urgency:</strong> High - Product quality affected
            </div>
            <div class="info-item">
              <strong>Difficulty:</strong> Advanced
            </div>
            <div class="info-item">
              <strong>Time:</strong> 35-45 minutes
            </div>
          </div>
        </div>

        <div class="background-section">
          <div class="background-text">
            <div class="scenario-description">
              <h3>Background</h3>
              <p>A chemical reactor's pH control system is showing unstable behavior during critical production runs.</p>
              
              <p>The pH value oscillates around the setpoint more than usual, affecting product quality and consistency.</p>
              
              <p>The control valve for acid addition appears to be hunting, constantly adjusting position.</p>
              
              <p>The pH sensor was calibrated last week and shows correct buffer readings, but something is clearly wrong.</p>
            </div>
          </div>
          
          <div class="background-image">
            <img src="assets/scenarios/ph-control.png" alt="pH Control System">
            <figcaption>pH Control System - Chemical Processing</figcaption>
          </div>
        </div>

        <div class="system-overview">
          <h3>System Status</h3>
          <div class="status-grid">
            <div class="status-item">
              <span class="status-label">pH Setpoint:</span>
              <span class="status-value">7.0</span>
            </div>
            <div class="status-item">
              <span class="status-label">Current pH:</span>
              <span class="status-value">7.1</span>
            </div>
            <div class="status-item">
              <span class="status-label">pH Oscillation:</span>
              <span class="status-value warning">±0.4</span>
            </div>
            <div class="status-item">
              <span class="status-label">Valve Position:</span>
              <span class="status-value">52%</span>
            </div>
            <div class="status-item">
              <span class="status-label">Valve Hunting:</span>
              <span class="status-value warning">ACTIVE</span>
            </div>
            <div class="status-item">
              <span class="status-label">Reactor Temperature:</span>
              <span class="status-value">85°C</span>
            </div>
            <div class="status-item">
              <span class="status-label">Reactor Level:</span>
              <span class="status-value">75%</span>
            </div>
            <div class="status-item">
              <span class="status-label">Control Stability:</span>
              <span class="status-value warning">POOR</span>
            </div>
            <div class="status-item">
              <span class="status-label">Product Quality:</span>
              <span class="status-value warning">DECLINING</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Troubleshooting Tips Section -->
    <div class="worksheet-section objectives-section">
      <h2 class="section-header"><i class="fas fa-lightbulb"></i> Troubleshooting Tips</h2>
      <div class="worksheet-content">
        <ul class="objectives-list">
          <li>Test pH sensor response time and accuracy with buffer solutions</li>
          <li>Check PID controller parameters and control loop stability</li>
          <li>Look for valve sizing issues and flow characteristics</li>
          <li>Monitor for process disturbances and their impact on control</li>
        </ul>
      </div>
    </div>

    <!-- Interactive Tools Section -->
    <div class="worksheet-section tools-section">
      <h2 class="section-header"><i class="fas fa-tools"></i> Investigation Tools</h2>
      <div class="worksheet-content">
        <div class="tools-grid">
          <div class="tool-card" onclick="useTool('analyze_ph_response')">
            <i class="fas fa-tachometer-alt"></i>
            <h3>Analyze pH Response Time</h3>
            <p>Test pH sensor response time and accuracy</p>
          </div>
          <div class="tool-card" onclick="useTool('review_control_tuning')">
            <i class="fas fa-sliders-h"></i>
            <h3>Review Control Tuning</h3>
            <p>Check PID parameters and control loop stability</p>
          </div>
          <div class="tool-card" onclick="useTool('check_mixing_efficiency')">
            <i class="fas fa-blender"></i>
            <h3>Check Mixing Efficiency</h3>
            <p>Verify proper mixing of acid addition</p>
          </div>
          <div class="tool-card" onclick="useTool('validate_sensor_installation')">
            <i class="fas fa-map-marker-alt"></i>
            <h3>Validate Sensor Installation</h3>
            <p>Check sensor location and installation quality</p>
          </div>
        </div>
        <div id="tool-results" class="tool-results"></div>
      </div>
    </div>

    <!-- Simulation Section -->
    <div class="worksheet-section simulation-section">
      <h2 class="section-header"><i class="fas fa-cogs"></i> System Simulation</h2>
      <div class="worksheet-content">
        <div id="ph-control-simulation" class="simulation-container">
          <div class="simulation-loading">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Loading pH control simulation...</p>
          </div>
        </div>
        <!-- Simulation panels commented out for consistency with other scenarios -->
        <!-- <div id="hmi-panel" class="simulation-container" style="margin-top: 20px;"></div> -->
        <!-- <div id="plc-io-panel" class="simulation-container" style="margin-top: 20px;"></div> -->
        <!-- <div id="fault-injection-panel" class="simulation-panel" style="margin-top: 20px;"></div> -->
        <!-- <div id="diagnostic-challenges-panel" class="simulation-panel" style="margin-top: 20px;"></div> -->
      </div>
    </div>

    <!-- Assessment Questions Section -->
    <div class="worksheet-section questions-section">
      <h2 class="section-header"><i class="fas fa-question-circle"></i> Assessment Questions</h2>
      <div class="worksheet-content">
        <div class="question-card">
          <h3>Question 8.1</h3>
          <p>What is the most likely cause of pH control valve hunting?</p>
          <div class="answer-input">
            <textarea data-question="8.1" placeholder="Enter your answer here..." rows="4"></textarea>
          </div>
          <button onclick="submitAnswer('8.1')" class="submit-btn">Submit Answer</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Simulation scripts commented out to prevent JavaScript conflicts -->
  <!-- <script src="hmi-simulation.js"></script> -->
  <!-- <script src="plc-simulation.js"></script> -->
  <!-- <script src="valve-simulation.js"></script> -->
  <!-- <script src="pump-simulation.js"></script> -->
  <script>
    // Tool usage tracking
    let toolResults = {};
    
    function useTool(toolId) {
      const toolData = {
        'analyze_ph_response': {
          title: 'pH Response Time Analysis',
          content: 'pH sensor response time test shows 45-second delay (should be <15 seconds). Sensor is responding slowly to pH changes, causing control loop instability. Calibration is correct but response time is inadequate.',
          icon: 'fas fa-tachometer-alt'
        },
        'review_control_tuning': {
          title: 'Control Tuning Review Results',
          content: 'PID parameters show aggressive tuning with high proportional gain (2.5) and low integral time (30s). Controller is overreacting to pH changes, causing hunting behavior. Tuning is inappropriate for slow-responding pH system.',
          icon: 'fas fa-sliders-h'
        },
        'check_mixing_efficiency': {
          title: 'Mixing Efficiency Analysis',
          content: 'Mixing efficiency test reveals poor acid distribution in reactor. Acid addition point is too close to pH sensor, causing local pH variations. Mixing time is 3 minutes (should be <1 minute) for proper pH response.',
          icon: 'fas fa-blender'
        },
        'validate_sensor_installation': {
          title: 'Sensor Installation Validation',
          content: 'pH sensor installation check shows sensor is located in dead zone with poor flow. Sensor is mounted too close to reactor wall and acid injection point. Installation location is causing measurement delays and local pH variations.',
          icon: 'fas fa-map-marker-alt'
        }
      };
      
      const result = toolData[toolId];
      if (result) {
        toolResults[toolId] = result;
        displayToolResult(toolId, result);
      }
    }
    
    function displayToolResult(toolId, result) {
      const resultsDiv = document.getElementById('tool-results');
      const resultHtml = `
        <div class="tool-result" id="result-${toolId}">
          <div class="result-header">
            <i class="${result.icon}"></i>
            <h3>${result.title}</h3>
          </div>
          <div class="result-content">
            <p>${result.content}</p>
          </div>
        </div>
      `;
      resultsDiv.innerHTML += resultHtml;
    }
    
    // Submit answer
    function submitAnswer(questionId) {
      const input = document.querySelector(`[data-question="${questionId}"]`);
      const answer = input.value.trim();
      
      if (answer) {
        // Save to local storage for backward compatibility
        localStorage.setItem(`fault8_${questionId}`, answer);
        
        // Track with the tracking system if available
        if (typeof trackFaultScenarioAnswer === 'function') {
          trackFaultScenarioAnswer(questionId, answer);
        }
        
        const button = event.target;
        const originalText = button.textContent;
        button.textContent = 'Saved!';
        button.style.background = '#4CAF50';
        
        setTimeout(() => {
          button.textContent = originalText;
        }, 2000);
      } else {
        alert('Please enter content before saving.');
      }
    }
    
    // Load saved answers on page load
    document.addEventListener('DOMContentLoaded', function() {
      const savedAnswer = localStorage.getItem('fault8_8.1');
      if (savedAnswer !== null) {
        const textarea = document.querySelector('[data-question="8.1"]');
        if (textarea) textarea.value = savedAnswer;
      }
    });
  </script>
</body>
</html> 
