<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Matrix TSL - Worksheet Progress Tracking</title>
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="icon" type="image/x-icon" href="assets/icons/matrix-icon.ico">
  <script src="worksheet-tracking.js"></script>
  <style>
    .tracking-dashboard {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    
    .dashboard-header {
      text-align: center;
      margin-bottom: 30px;
      background: linear-gradient(135deg, var(--background-color) 0%, #1a1d20 100%);
      padding: 30px;
      border-radius: 10px;
      color: white;
      border: 2px solid var(--accent-color);
      box-shadow: 0 8px 32px rgba(0,0,0,0.5);
    }
    
    .overall-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .stat-card {
      background: #23272b;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      text-align: center;
      border-left: 4px solid var(--accent-color);
      color: white;
    }
    
    .stat-number {
      font-size: 2.5em;
      font-weight: bold;
      color: var(--accent-color);
      margin-bottom: 10px;
    }
    
    .stat-label {
      color: #9da5b1;
      font-size: 0.9em;
    }
    
    .progress-section {
      background: #23272b;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      margin-bottom: 20px;
      color: white;
    }
    
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #444;
    }
    
    .section-header h2 {
      color: var(--accent-color);
    }
    
    .section-count {
      color: var(--accent-color);
      font-weight: bold;
      font-size: 1.1em;
    }
    
    .worksheet-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }
    
    .worksheet-card {
      border: 1px solid #444;
      border-radius: 8px;
      padding: 20px;
      transition: transform 0.2s, box-shadow 0.2s;
      cursor: pointer;
      background: #2d2d2d;
      color: white;
    }
    
    .worksheet-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.4);
      border-color: var(--accent-color);
    }
    
    .worksheet-card.completed {
      border-left: 4px solid var(--accent-color);
      background: linear-gradient(135deg, rgba(74, 158, 255, 0.1) 0%, rgba(74, 158, 255, 0.05) 100%);
    }
    
    .worksheet-card.incomplete {
      border-left: 4px solid #ff9800;
      background: linear-gradient(135deg, rgba(255, 152, 0, 0.1) 0%, rgba(255, 152, 0, 0.05) 100%);
    }
    
    .worksheet-card.not-started {
      border-left: 4px solid #666;
      background: linear-gradient(135deg, rgba(102, 102, 102, 0.1) 0%, rgba(102, 102, 102, 0.05) 100%);
    }
    
    .worksheet-title {
      font-size: 1.1em;
      font-weight: bold;
      margin-bottom: 10px;
      color: white;
    }
    
    .worksheet-type {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8em;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .worksheet-type.maintenance {
      background: rgba(74, 158, 255, 0.15);
      color: var(--accent-color);
      border: 1px solid rgba(74, 158, 255, 0.3);
    }
    
    .worksheet-type.fault {
      background: rgba(255, 152, 0, 0.15);
      color: #ff9800;
      border: 1px solid rgba(255, 152, 0, 0.3);
    }
    
    /* Special styling for fault scenario cards to make them distinct */
    .progress-section:nth-child(4) .worksheet-card {
      border-left-color: #ff9800;
    }
    
    .progress-section:nth-child(4) .worksheet-card.completed {
      border-left: 4px solid #ff9800;
      background: linear-gradient(135deg, rgba(255, 152, 0, 0.1) 0%, rgba(255, 152, 0, 0.05) 100%);
    }
    
    .progress-section:nth-child(4) .worksheet-card.incomplete {
      border-left: 4px solid #ff9800;
      background: linear-gradient(135deg, rgba(255, 152, 0, 0.1) 0%, rgba(255, 152, 0, 0.05) 100%);
    }
    
    .progress-section:nth-child(4) .worksheet-card.not-started {
      border-left: 4px solid #666;
      background: linear-gradient(135deg, rgba(102, 102, 102, 0.1) 0%, rgba(102, 102, 102, 0.05) 100%);
    }
    
    .progress-bar {
      background: #444;
      height: 8px;
      border-radius: 4px;
      overflow: hidden;
      margin: 10px 0;
    }
    
    .progress-fill {
      height: 100%;
      transition: width 0.3s ease;
    }
    
    .progress-fill.completed {
      background: linear-gradient(90deg, var(--accent-color), #3a8ce6);
    }
    
    .progress-fill.incomplete {
      background: linear-gradient(90deg, #ff9800, #ffb74d);
    }
    
    .progress-fill.not-started {
      background: linear-gradient(90deg, #666, #888);
    }
    
    /* Fault scenario progress bars use orange for completed state */
    .progress-section:nth-child(4) .progress-fill.completed {
      background: linear-gradient(90deg, #ff9800, #ffb74d);
    }
    
    .worksheet-stats {
      display: flex;
      justify-content: space-between;
      font-size: 0.9em;
      color: #9da5b1;
      margin-top: 10px;
    }
    
    .export-section {
      background: #23272b;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      margin-bottom: 20px;
      color: white;
    }
    
    .export-buttons {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }
    
    .export-btn {
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .export-btn.json {
      background: linear-gradient(135deg, #2196F3, #1976D2);
      color: white;
    }
    
    .export-btn.csv {
      background: linear-gradient(135deg, #4CAF50, #388E3C);
      color: white;
    }
    
    .export-btn.pdf {
      background: linear-gradient(135deg, #f44336, #d32f2f);
      color: white;
    }
    
    .export-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.4);
    }
    
    .student-info {
      background: #23272b;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.3);
      margin-bottom: 20px;
      color: white;
    }
    
    .student-form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 15px;
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
    }
    
    .form-group label {
      margin-bottom: 5px;
      font-weight: bold;
      color: white;
    }
    
    .form-group input {
      padding: 10px;
      border: 2px solid #444;
      border-radius: 4px;
      font-size: 14px;
      background: #2d2d2d;
      color: white;
      transition: border-color 0.3s ease;
    }
    
    .form-group input:focus {
      outline: none;
      border-color: var(--accent-color);
    }
    
    .save-btn {
      background: linear-gradient(135deg, var(--accent-color), #3a8ce6);
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      margin-top: 10px;
      transition: background 0.2s;
    }
    
    .save-btn:hover {
      background: linear-gradient(135deg, #3a8ce6, #2d7dd2);
    }
    
    .last-activity {
      font-size: 0.9em;
      color: #9da5b1;
      margin-top: 10px;
    }
    
    .no-progress {
      text-align: center;
      padding: 40px;
      color: #9da5b1;
      font-style: italic;
    }
    
    .file-input-wrapper {
      position: relative;
      display: inline-block;
      margin: 10px 0;
    }
    
    .file-input {
      position: absolute;
      opacity: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }
    
    .file-input-label {
      background: linear-gradient(135deg, #2196F3, #1976D2);
      color: white;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
    }
    
    .file-input-label:hover {
      background: linear-gradient(135deg, #1976D2, #1565C0);
    }
    
    @media (max-width: 768px) {
      .student-form {
        grid-template-columns: 1fr;
      }
      
      .export-buttons {
        flex-direction: column;
      }
      
      .worksheet-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="main-navigation">
    <div class="nav-container">
      <div class="nav-logo">
        <img src="assets/matrix-logo.png" alt="Matrix Logo">
      </div>
      <ul class="nav-menu" id="nav-menu">
        <li class="nav-item">
          <a href="#" onclick="window.location='index.html'" class="nav-link">
            <i class="fas fa-home"></i> HOME
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='cp0539-worksheets.html'" class="nav-link">
            <i class="fas fa-cogs"></i> CP0539
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='cp6773-worksheets.html'" class="nav-link">
            <i class="fas fa-exclamation-triangle"></i> CP6773
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='tracking-dashboard.html'" class="nav-link active">
            <i class="fas fa-chart-line"></i> PROGRESS
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='settings.html'" class="nav-link">
            <i class="fas fa-gear"></i> SETTINGS
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='about.html'" class="nav-link">
            <i class="fas fa-info-circle"></i> ABOUT
          </a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="tracking-dashboard">
    <div class="dashboard-header">
      <h1><i class="fas fa-chart-line"></i> Worksheet Progress Tracking</h1>
      <p>Track your progress across all worksheets and export results for your teacher</p>
      <div style="margin-top: 15px;">
        <a href="progress-guide.html" style="color: var(--accent-color); text-decoration: none; font-weight: bold; display: inline-flex; align-items: center; gap: 8px; padding: 8px 16px; border: 2px solid var(--accent-color); border-radius: 6px; transition: all 0.3s;">
          <i class="fas fa-question-circle"></i> View Complete Import/Export Guide
        </a>
      </div>
    </div>

    <!-- Student Information -->
    <div class="student-info">
      <h2><i class="fas fa-user"></i> Student Information</h2>
      <form id="studentForm" class="student-form">
        <div class="form-group">
          <label for="studentName">Student Name:</label>
          <input type="text" id="studentName" placeholder="Enter your name">
        </div>
        <div class="form-group">
          <label for="studentId">Student ID:</label>
          <input type="text" id="studentId" placeholder="Enter your student ID">
        </div>
        <button type="submit" class="save-btn">Save Information</button>
      </form>
    </div>

    <!-- Overall Statistics -->
    <div class="progress-section">
      <h2><i class="fas fa-tachometer-alt"></i> Overall Progress</h2>
      <div class="overall-stats" id="overallStats">
        <!-- Stats will be populated by JavaScript -->
      </div>
    </div>

    <!-- Export Section -->
    <div class="export-section">
      <h2><i class="fas fa-download"></i> Export Progress Report</h2>
      <p>Export your complete progress report in various formats to share with your teacher:</p>
      <div class="export-buttons">
        <button class="export-btn json" onclick="exportToJSON()">
          <i class="fas fa-file-code"></i> Export as JSON
        </button>
        <button class="export-btn csv" onclick="exportToCSV()">
          <i class="fas fa-file-csv"></i> Export as CSV
        </button>
        <button class="export-btn pdf" onclick="exportToPDF()">
          <i class="fas fa-file-pdf"></i> Export as PDF
        </button>
      </div>
      
      <div style="margin-top: 20px; padding-top: 20px; border-top: 1px solid #444;">
        <h3 style="color: var(--accent-color); margin-bottom: 15px;">
          <i class="fas fa-upload"></i> Import Progress Data
        </h3>
        <p style="margin-bottom: 15px; color: #9da5b1;">
          Import your progress from a previously exported JSON file. This will replace your current data.
        </p>
        <div class="file-input-wrapper">
          <input type="file" id="importFile" class="file-input" accept=".json" onchange="importProgressData(this)">
          <label for="importFile" class="file-input-label">
            <i class="fas fa-upload"></i> Choose JSON File to Import
          </label>
        </div>
        <div id="importStatus" style="margin-top: 10px; padding: 10px; border-radius: 4px; display: none;"></div>
      </div>
    </div>

    <!-- Debug Section (Temporary) -->
    <div class="guide-section" style="background: linear-gradient(135deg, rgba(255, 152, 0, 0.1) 0%, rgba(255, 152, 0, 0.05) 100%); border: 2px solid #ff9800; margin-bottom: 25px;">
      <h2><i class="fas fa-bug"></i> Debug Information</h2>
      <p style="margin-bottom: 15px; color: #9da5b1;">
        This section shows the raw data to help troubleshoot tracking issues.
      </p>
      <button class="demo-btn" onclick="showDebugInfo()" style="background: linear-gradient(135deg, #ff9800, #f57c00);">
        <i class="fas fa-eye"></i> Show Debug Data
      </button>
      <div id="debugInfo" style="margin-top: 15px; padding: 15px; background: #1a1d20; border-radius: 6px; display: none; font-family: monospace; font-size: 12px; color: #9da5b1; max-height: 300px; overflow-y: auto;"></div>
    </div>

    <!-- Help & Guide Section -->
    <div class="guide-section" style="background: linear-gradient(135deg, rgba(74, 158, 255, 0.1) 0%, rgba(74, 158, 255, 0.05) 100%); border: 2px solid var(--accent-color); margin-bottom: 25px;">
      <h2><i class="fas fa-question-circle"></i> Need Help with Import/Export?</h2>
      <p style="margin-bottom: 20px; color: #9da5b1;">
        Learn how to backup your progress, transfer data between devices, and share results with your teacher.
      </p>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px;">
        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; border-left: 4px solid var(--accent-color);">
          <h4 style="color: var(--accent-color); margin-bottom: 10px;">
            <i class="fas fa-download"></i> Export Guide
          </h4>
          <p style="font-size: 0.9em; color: #9da5b1;">
            Learn how to export your progress in different formats and when to use each one.
          </p>
        </div>
        
        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; border-left: 4px solid var(--accent-color);">
          <h4 style="color: var(--accent-color); margin-bottom: 10px;">
            <i class="fas fa-upload"></i> Import Guide
          </h4>
          <p style="font-size: 0.9em; color: #9da5b1;">
            Transfer your progress to a new device or restore from a backup file.
          </p>
        </div>
        
        <div style="background: rgba(255,255,255,0.1); padding: 15px; border-radius: 8px; border-left: 4px solid var(--accent-color);">
          <h4 style="color: var(--accent-color); margin-bottom: 10px;">
            <i class="fas fa-exclamation-triangle"></i> Troubleshooting
          </h4>
          <p style="font-size: 0.9em; color: #9da5b1;">
            Common issues and solutions for import/export problems.
          </p>
        </div>
      </div>
      
      <div style="text-align: center;">
        <a href="progress-guide.html" style="background: linear-gradient(135deg, var(--accent-color), #3a8ce6); color: white; padding: 12px 24px; border-radius: 6px; text-decoration: none; font-weight: bold; display: inline-flex; align-items: center; gap: 8px; transition: all 0.3s;">
          <i class="fas fa-book-open"></i> View Complete Guide
        </a>
      </div>
    </div>

    <!-- Maintenance Worksheets -->
    <div class="progress-section">
      <div class="section-header">
        <h2><i class="fas fa-cogs"></i> Maintenance Worksheets (CP0539)</h2>
        <span class="section-count" id="maintenanceCount">0/14</span>
      </div>
      <div class="worksheet-grid" id="maintenanceWorksheets">
        <!-- Worksheets will be populated by JavaScript -->
      </div>
    </div>

    <!-- Fault Worksheets -->
    <div class="progress-section">
      <div class="section-header">
        <h2><i class="fas fa-exclamation-triangle"></i> Fault Scenarios (CP6773)</h2>
        <span class="section-count" id="faultCount">0/8</span>
      </div>
      <div class="worksheet-grid" id="faultWorksheets">
        <!-- Worksheets will be populated by JavaScript -->
      </div>
    </div>
  </div>

  <script>
    // Load settings and apply accent color
    function loadSettings() {
      try {
        const settings = JSON.parse(localStorage.getItem('app-settings') || '{}');
        if (settings.appAccent) {
          document.documentElement.style.setProperty('--accent-color', settings.appAccent);
        }
      } catch (error) {
        console.warn('Could not load settings:', error);
      }
    }

    // Initialize dashboard when page loads
    document.addEventListener('DOMContentLoaded', function() {
      loadSettings();
      initializeDashboard();
      loadStudentInfo();
    });

    function initializeDashboard() {
      updateOverallStats();
      updateWorksheetsDisplay();
    }

    function formatLastActivity(lastActivity) {
      if (!lastActivity) {
        return 'Never';
      }
      
      try {
        const date = new Date(lastActivity);
        
        // Check if the date is valid and not in the future
        if (isNaN(date.getTime()) || date > new Date()) {
          // Clear invalid data
          clearInvalidLastActivity();
          return 'Never';
        }
        
        // Format as DD/MM/YYYY
        const day = date.getDate().toString().padStart(2, '0');
        const month = (date.getMonth() + 1).toString().padStart(2, '0');
        const year = date.getFullYear();
        
        return `${day}/${month}/${year}`;
      } catch (error) {
        console.warn('Error formatting last activity date:', error);
        // Clear invalid data
        clearInvalidLastActivity();
        return 'Never';
      }
    }

    function clearInvalidLastActivity() {
      try {
        const saved = localStorage.getItem('worksheet-overall-progress');
        if (saved) {
          const stats = JSON.parse(saved);
          if (stats.lastActivity) {
            const date = new Date(stats.lastActivity);
            if (isNaN(date.getTime()) || date > new Date()) {
              stats.lastActivity = null;
              localStorage.setItem('worksheet-overall-progress', JSON.stringify(stats));
              console.log('Cleared invalid last activity date');
            }
          }
        }
      } catch (error) {
        console.warn('Error clearing invalid last activity:', error);
      }
    }

    function updateOverallStats() {
      const overallStats = worksheetTracker.getOverallProgress();
      const statsContainer = document.getElementById('overallStats');
      
      statsContainer.innerHTML = `
        <div class="stat-card">
          <div class="stat-number">${overallStats.totalWorksheets}</div>
          <div class="stat-label">Total Worksheets</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${overallStats.completedWorksheets}</div>
          <div class="stat-label">Completed Worksheets</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${overallStats.totalQuestions}</div>
          <div class="stat-label">Total Questions</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${overallStats.completedQuestions}</div>
          <div class="stat-label">Completed Questions</div>
        </div>
        <div class="stat-card">
          <div class="stat-number">${overallStats.completionPercentage}%</div>
          <div class="stat-label">Overall Completion</div>
        </div>
      `;
    }

    function updateWorksheetsDisplay() {
      const allProgress = worksheetTracker.getAllProgress();
      
      // Debug: Log the progress data
      console.log('All Progress Data:', allProgress);
      
      // Update maintenance worksheets
      const maintenanceContainer = document.getElementById('maintenanceWorksheets');
      const maintenanceCount = document.getElementById('maintenanceCount');
      let maintenanceCompleted = 0;
      
      maintenanceContainer.innerHTML = worksheetTracker.worksheets.maintenance.map(worksheet => {
        const progress = allProgress[`maintenance-${worksheet.id}`];
        const statusClass = progress.completedQuestions === 0 ? 'not-started' : 
                          progress.completionPercentage === 100 ? 'completed' : 'incomplete';
        const progressClass = progress.completedQuestions === 0 ? 'not-started' : 
                            progress.completionPercentage === 100 ? 'completed' : 'incomplete';
        
        if (progress.completedQuestions > 0) maintenanceCompleted++;
        
        return `
          <div class="worksheet-card ${statusClass}" onclick="openWorksheet('maintenance', ${worksheet.id})">
            <div class="worksheet-title">${worksheet.title}</div>
            <span class="worksheet-type maintenance">Maintenance</span>
            <div class="progress-bar">
              <div class="progress-fill ${progressClass}" style="width: ${progress.completionPercentage}%"></div>
            </div>
            <div class="worksheet-stats">
              <span>${progress.completedQuestions}/${progress.totalQuestions} questions</span>
              <span>${progress.completionPercentage}%</span>
            </div>
            ${progress.lastUpdated ? `<div class="last-activity">Last updated: ${new Date(progress.lastUpdated).toLocaleString()}</div>` : ''}
          </div>
        `;
      }).join('');
      
      maintenanceCount.textContent = `${maintenanceCompleted}/${worksheetTracker.worksheets.maintenance.length}`;
      
      // Update fault worksheets
      const faultContainer = document.getElementById('faultWorksheets');
      const faultCount = document.getElementById('faultCount');
      let faultCompleted = 0;
      
      faultContainer.innerHTML = worksheetTracker.worksheets.fault.map(worksheet => {
        const progress = allProgress[`fault-${worksheet.id}`];
        const statusClass = progress.completedQuestions === 0 ? 'not-started' : 
                          progress.completionPercentage === 100 ? 'completed' : 'incomplete';
        const progressClass = progress.completedQuestions === 0 ? 'not-started' : 
                            progress.completionPercentage === 100 ? 'completed' : 'incomplete';
        
        if (progress.completedQuestions > 0) faultCompleted++;
        
        return `
          <div class="worksheet-card ${statusClass}" onclick="openWorksheet('fault', ${worksheet.id})">
            <div class="worksheet-title">${worksheet.title}</div>
            <span class="worksheet-type fault">Fault Scenario</span>
            <div class="progress-bar">
              <div class="progress-fill ${progressClass}" style="width: ${progress.completionPercentage}%"></div>
            </div>
            <div class="worksheet-stats">
              <span>${progress.completedQuestions}/${progress.totalQuestions} questions</span>
              <span>${progress.completionPercentage}%</span>
            </div>
            ${progress.lastUpdated ? `<div class="last-activity">Last updated: ${new Date(progress.lastUpdated).toLocaleString()}</div>` : ''}
          </div>
        `;
      }).join('');
      
      faultCount.textContent = `${faultCompleted}/${worksheetTracker.worksheets.fault.length}`;
    }

    function openWorksheet(type, id) {
      if (type === 'maintenance') {
        window.location.href = `worksheet-${id}.html`;
      } else if (type === 'fault') {
        window.location.href = `fault-scenario-${id}.html`;
      }
    }

    function showDebugInfo() {
      const debugDiv = document.getElementById('debugInfo');
      const allProgress = worksheetTracker.getAllProgress();
      const overallStats = worksheetTracker.getOverallProgress();
      
      const debugData = {
        overallStats,
        allProgress,
        localStorage: {
          'worksheet-overall-progress': localStorage.getItem('worksheet-overall-progress'),
          'student-name': localStorage.getItem('student-name'),
          'student-id': localStorage.getItem('student-id')
        },
        worksheetTrackerAvailable: typeof worksheetTracker !== 'undefined'
      };
      
      debugDiv.innerHTML = `<pre>${JSON.stringify(debugData, null, 2)}</pre>`;
      debugDiv.style.display = 'block';
    }

    function loadStudentInfo() {
      const studentInfo = worksheetTracker.getStudentInfo();
      document.getElementById('studentName').value = studentInfo.name;
      document.getElementById('studentId').value = studentInfo.id;
    }

    // Student form submission
    document.getElementById('studentForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const name = document.getElementById('studentName').value;
      const id = document.getElementById('studentId').value;
      
      worksheetTracker.setStudentInfo(name, id);
      
      // Show success message
      const saveBtn = document.querySelector('.save-btn');
      const originalText = saveBtn.textContent;
      saveBtn.textContent = 'Saved!';
      saveBtn.style.background = '#4CAF50';
      
      setTimeout(() => {
        saveBtn.textContent = originalText;
        saveBtn.style.background = '#4CAF50';
      }, 2000);
    });

    // Export functions
    function exportToJSON() {
      worksheetTracker.exportToJSON();
    }

    function exportToCSV() {
      worksheetTracker.exportToCSV();
    }

    function exportToPDF() {
      worksheetTracker.exportToPDF();
    }

    // Import function
    function importProgressData(input) {
      const file = input.files[0];
      if (!file) return;

      const statusDiv = document.getElementById('importStatus');
      
      // Show loading status
      statusDiv.style.display = 'block';
      statusDiv.style.background = 'linear-gradient(135deg, #2f2f1a 0%, #4a4a2d 100%)';
      statusDiv.style.border = '1px solid #ff9800';
      statusDiv.style.color = '#ff9800';
      statusDiv.textContent = 'Importing data...';

      worksheetTracker.importFromFile(file)
        .then(result => {
          if (result.success) {
            statusDiv.style.background = 'linear-gradient(135deg, #1a2f1a 0%, #2d4a2d 100%)';
            statusDiv.style.border = '1px solid #4CAF50';
            statusDiv.style.color = '#4CAF50';
            statusDiv.textContent = result.message + ' Refreshing page...';
            
            // Clear the file input
            input.value = '';
            
            // Refresh the page to show updated data
            setTimeout(() => {
              window.location.reload();
            }, 2000);
          } else {
            throw new Error(result.message);
          }
        })
        .catch(error => {
          statusDiv.style.background = 'linear-gradient(135deg, #2f1a1a 0%, #4a2d2d 100%)';
          statusDiv.style.border = '1px solid #f44336';
          statusDiv.style.color = '#f44336';
          statusDiv.textContent = 'Import failed: ' + error.message;
          
          // Clear the file input
          input.value = '';
        });
    }

    // Refresh dashboard every 30 seconds
    setInterval(() => {
      updateOverallStats();
      updateWorksheetsDisplay();
    }, 30000);
  </script>
</body>
</html> 