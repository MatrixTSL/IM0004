<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Matrix TSL - Fault Scenario 7: CNC Machines Offset Issues</title>
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="icon" type="image/x-icon" href="assets/icons/matrix-icon.ico">    <script src="worksheet-core.js"></script>
<script src="worksheet-tracking.js"></script>

</head>
<body>
  <!-- Navigation -->
  <nav class="main-navigation">
    <div class="nav-container">
      <div class="nav-logo">
        <img src="assets/matrix-logo.png" alt="Matrix Logo">
      </div>
      <ul class="nav-menu">
        <li class="nav-item">
          <a href="#" onclick="window.location='index.html'" class="nav-link">
            <i class="fas fa-home"></i> HOME
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='cp0539-worksheets.html'" class="nav-link">
            <i class="fas fa-cogs"></i> CP0539
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='cp6773-worksheets.html'" class="nav-link active">
            <i class="fas fa-exclamation-triangle"></i> CP6773
          </a>
        </li>
        
        <li class="nav-item">
          <a href="#" onclick="window.location='tracking-dashboard.html'" class="nav-link">
            <i class="fas fa-chart-line"></i> PROGRESS
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='about.html'" class="nav-link">
            <i class="fas fa-info-circle"></i> ABOUT
          </a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="worksheet-box">
    <!-- Integrated Worksheet Header -->
    <div class="worksheet-header">
      <div class="worksheet-header-content">
        <div class="worksheet-header-left">
          <button class="worksheet-nav-btn worksheet-back-btn" onclick="window.location.href='fault-scenario-6.html'">
            <i class="fas fa-arrow-left"></i>
            <span>Previous Scenario</span>
          </button>
        </div>
        <div class="worksheet-header-center">
          <h1 class="worksheet-title">Fault Scenario 7 - CNC Machines Offset Issues</h1>
        </div>
        <div class="worksheet-header-right">
          <button class="worksheet-nav-btn worksheet-next-btn" onclick="window.location.href='fault-scenario-8.html'">
            <span>Next Scenario</span>
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>

    <!-- Introduction Section -->
    <div class="worksheet-section introduction-section">
      <h2 class="section-header"><i class="fas fa-info-circle"></i> Fault Scenario 7: CNC Machines Offset Issues</h2>
      <div class="worksheet-content">
        <div class="scenario-info">
          <div class="info-grid">
            <div class="info-item">
              <strong>Company:</strong> Automotive Parts Manufacturing
            </div>
            <div class="info-item">
              <strong>Process:</strong> CNC machining operations
            </div>
            <div class="info-item">
              <strong>Shift:</strong> Night shift operator call-out
            </div>
            <div class="info-item">
              <strong>Urgency:</strong> High - Production stopped, system won't run
            </div>
            <div class="info-item">
              <strong>Difficulty:</strong> Advanced
            </div>
            <div class="info-item">
              <strong>Time:</strong> 20-30 minutes
            </div>
          </div>
        </div>

        <div class="background-section">
          <div class="background-text">
            <div class="scenario-description">
              <h3>Background</h3>
              <p>Those CNC machines you fixed in Scenario 3 are down again. The night shift operator has reiterated that he's checked all the offsets on all the inputs and outputs â€“ there's nothing! The system just won't run. You know that the operators like to play with settings so you're sure it's the offsets again.</p>
            </div>
          </div>
          
          <div class="background-image">
            <img src="assets/scenarios/injection-mold.png" alt="CNC Machining System">
            <figcaption>CNC Machining System - Automotive Manufacturing</figcaption>
          </div>
        </div>

        <div class="system-overview">
          <h3>System Status</h3>
          <div class="status-grid">
            <div class="status-item">
              <span class="status-label">System Operation:</span>
              <span class="status-value error">WON'T RUN</span>
            </div>
            <div class="status-item">
              <span class="status-label">Temp Offset:</span>
              <span class="status-value">0</span>
            </div>
            <div class="status-item">
              <span class="status-label">Current Temp:</span>
              <span class="status-value">50C</span>
            </div>
            <div class="status-item">
              <span class="status-label">Status LED:</span>
              <span class="status-value warning">ORANGE</span>
            </div>
            <div class="status-item">
              <span class="status-label">Production Status:</span>
              <span class="status-value error">STOPPED</span>
            </div>
            <div class="status-item">
              <span class="status-label">Machine Safety:</span>
              <span class="status-value">NO CRASH DETECTED</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Troubleshooting Tips Section -->
    <div class="worksheet-section objectives-section">
      <h2 class="section-header"><i class="fas fa-lightbulb"></i> Troubleshooting Tips</h2>
      <div class="worksheet-content">
        <ul class="objectives-list">
          <li>Check temperature sensor calibration and offset values</li>
          <li>Verify current temperature readings against expected values</li>
          <li>Inspect temperature control system configuration</li>
          <li>Review recent changes to temperature control parameters</li>
        </ul>
      </div>
    </div>

    <!-- Interactive Tools Section - Commented out as requested -->
    <!-- <div class="worksheet-section tools-section">
      <h2 class="section-header"><i class="fas fa-tools"></i> Investigation Tools</h2>
      <div class="worksheet-content">
        <div class="tools-grid">
          <div class="tool-card" onclick="useTool('check_tool_offsets')">
            <i class="fas fa-wrench"></i>
            <h3>Check Tool Offsets</h3>
            <p>Verify tool offset values against standard settings</p>
          </div>
          <div class="tool-card" onclick="useTool('verify_work_offsets')">
            <i class="fas fa-crosshairs"></i>
            <h3>Verify Work Offsets</h3>
            <p>Check work offset coordinates and reference points</p>
          </div>
          <div class="tool-card" onclick="useTool('inspect_program_parameters')">
            <i class="fas fa-cog"></i>
            <h3>Inspect Program Parameters</h3>
            <p>Check program parameters and machine configuration</p>
          </div>
          <div class="tool-card" onclick="useTool('review_operator_changes')">
            <i class="fas fa-history"></i>
            <h3>Review Operator Changes</h3>
            <p>Check recent operator modifications to offset settings</p>
          </div>
        </div>
        <div id="tool-results" class="tool-results"></div>
      </div>
    </div> -->

    <!-- Simulation Section - Commented out for consistency with other scenarios -->
    <!-- <div class="worksheet-section simulation-section">
      <h2 class="section-header"><i class="fas fa-cogs"></i> System Simulation</h2>
      <div class="worksheet-content">
        <div id="injection-molding-simulation" class="simulation-container">
          <div class="simulation-loading">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Loading injection molding simulation...</p>
          </div>
        </div>
        <div id="hmi-panel" class="simulation-container" style="margin-top: 20px;"></div>
        <div id="plc-io-panel" class="simulation-container" style="margin-top: 20px;"></div>
        <div id="fault-injection-panel" class="simulation-panel" style="margin-top: 20px;"></div>
        <div id="diagnostic-challenges-panel" class="simulation-panel" style="margin-top: 20px;"></div>
      </div>
    </div> -->

    <!-- Assessment Questions Section -->
    <div class="worksheet-section questions-section">
      <h2 class="section-header"><i class="fas fa-clipboard-list"></i> Fault Analysis Worksheet</h2>
      <div class="questions-content">
        <div class="analysis-section">
          <h4>Observations:</h4>
          <textarea class="answer-input" data-question="observations" placeholder="Record your observations of the system behavior, readings, and any unusual indicators..."></textarea>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer('observations')">Save Observations</button>
          </div>
        </div>
        
        <div class="analysis-section">
          <h4>Problem:</h4>
          <textarea class="answer-input" data-question="problem" placeholder="Identify the root cause and describe the specific problem affecting the system..."></textarea>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer('problem')">Save Problem Analysis</button>
          </div>
        </div>
        
        <div class="analysis-section">
          <h4>Solution:</h4>
          <textarea class="answer-input" data-question="solution" placeholder="Describe the steps you would take to resolve the issue safely and effectively..."></textarea>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer('solution')">Save Solution</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Simulation scripts commented out to prevent JavaScript conflicts -->
  <!-- <script src="hmi-simulation.js"></script> -->
  <!-- <script src="plc-simulation.js"></script> -->
  <!-- <script src="valve-simulation.js"></script> -->
  <!-- <script src="pump-simulation.js"></script> -->
  <script>
    // Tool usage tracking
    let toolResults = {};
    
    function useTool(toolId) {
      const toolData = {
        'check_tool_offsets': {
          title: 'Tool Offset Analysis',
          content: 'Tool offset check reveals several tools have been modified from standard settings. Tool 1 offset changed from 0.000 to -0.015, Tool 2 from 0.000 to +0.008, Tool 3 from 0.000 to -0.022. These changes are preventing the machine from running.',
          icon: 'fas fa-wrench'
        },
        'verify_work_offsets': {
          title: 'Work Offset Verification',
          content: 'Work offset inspection shows G54 work offset has been modified from standard coordinates. X-axis offset changed from 0.000 to +0.125, Y-axis from 0.000 to -0.087, Z-axis from 0.000 to +0.203. These changes are causing positioning errors.',
          icon: 'fas fa-crosshairs'
        },
        'inspect_program_parameters': {
          title: 'Program Parameter Inspection',
          content: 'Program parameter check shows feed rate and spindle speed settings are correct. However, the program is referencing modified offset values that are preventing proper tool positioning. The machine cannot execute the program with current offset settings.',
          icon: 'fas fa-cog'
        },
        'review_operator_changes': {
          title: 'Operator Changes Review',
          content: 'Review of recent operator changes shows multiple offset modifications made during the previous shift. The operator attempted to compensate for tool wear but made incorrect adjustments. The changes are preventing the machine from running safely.',
          icon: 'fas fa-history'
        }
      };
      
      const result = toolData[toolId];
      if (result) {
        toolResults[toolId] = result;
        displayToolResult(toolId, result);
      }
    }
    
    function displayToolResult(toolId, result) {
      const resultsDiv = document.getElementById('tool-results');
      const resultHtml = `
        <div class="tool-result" id="result-${toolId}">
          <div class="result-header">
            <i class="${result.icon}"></i>
            <h3>${result.title}</h3>
          </div>
          <div class="result-content">
            <p>${result.content}</p>
          </div>
        </div>
      `;
      resultsDiv.innerHTML += resultHtml;
    }
    
    // Submit answer
    function submitAnswer(questionId) {
      const input = document.querySelector(`[data-question="${questionId}"]`);
      const answer = input.value.trim();
      
      if (answer) {
        // Save to local storage for backward compatibility
        localStorage.setItem(`fault7_${questionId}`, answer);
        
        // Track with the tracking system if available
        if (typeof trackFaultScenarioAnswer === 'function') {
          trackFaultScenarioAnswer(questionId, answer);
        }
        
        const button = event.target;
        const originalText = button.textContent;
        button.textContent = 'Saved!';
        button.style.background = '#4CAF50';
        
        setTimeout(() => {
          button.textContent = originalText;
        }, 2000);
      } else {
        alert('Please enter content before saving.');
      }
    }
    
    // Load saved answers on page load
    document.addEventListener('DOMContentLoaded', function() {
      // Load observations
      const savedObservations = localStorage.getItem('fault7_observations');
      if (savedObservations !== null) {
        const textarea = document.querySelector('[data-question="observations"]');
        if (textarea) textarea.value = savedObservations;
      }
      
      // Load problem
      const savedProblem = localStorage.getItem('fault7_problem');
      if (savedProblem !== null) {
        const textarea = document.querySelector('[data-question="problem"]');
        if (textarea) textarea.value = savedProblem;
      }
      
      // Load solution
      const savedSolution = localStorage.getItem('fault7_solution');
      if (savedSolution !== null) {
        const textarea = document.querySelector('[data-question="solution"]');
        if (textarea) textarea.value = savedSolution;
      }
    });
  </script>
</body>
</html> 
