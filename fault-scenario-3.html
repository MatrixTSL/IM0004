<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-BMDTX8B88C"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-BMDTX8B88C');
  </script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Matrix TSL - Fault Scenario 3: CNC Cooling System</title>
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="icon" type="image/x-icon" href="assets/icons/matrix-icon.ico">    <script src="worksheet-core.js"></script>
<script src="worksheet-tracking.js"></script>
<script src="shared-components.js"></script>

</head>
<body>
  <!-- Navigation -->
  <nav class="main-navigation">
    <div class="nav-container">
      <div class="nav-logo">
        <img src="assets/matrix-logo.png" alt="Matrix Logo">
      </div>
      <ul class="nav-menu">
        <li class="nav-item">
          <a href="#" onclick="window.location='index.html'" class="nav-link">
            <i class="fas fa-home"></i> HOME
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='cp0539-worksheets.html'" class="nav-link">
            <i class="fas fa-cogs"></i> CP0539
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='cp6773-worksheets.html'" class="nav-link active">
            <i class="fas fa-exclamation-triangle"></i> CP6773
          </a>
        </li>
        
        <li class="nav-item">
          <a href="#" onclick="window.location='tracking-dashboard.html'" class="nav-link">
            <i class="fas fa-chart-line"></i> PROGRESS
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='about.html'" class="nav-link">
            <i class="fas fa-info-circle"></i> ABOUT
          </a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="worksheet-box">
    <!-- Integrated Worksheet Header -->
    <div class="worksheet-header">
      <div class="worksheet-header-content">
        <div class="worksheet-header-left">
          <button class="worksheet-nav-btn worksheet-back-btn" onclick="window.location.href='fault-scenario-2.html'">
            <i class="fas fa-arrow-left"></i>
            <span>Previous Scenario</span>
          </button>
        </div>
        <div class="worksheet-header-center">
          <h1 class="worksheet-title">Fault Scenario 3 - CNC Cooling System</h1>
        </div>
        <div class="worksheet-header-right">
          <button class="worksheet-nav-btn worksheet-next-btn" onclick="window.location.href='fault-scenario-4.html'">
            <span>Next Scenario</span>
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>
    <!-- Introduction Section -->
    <div class="worksheet-section introduction-section">
      <h2 class="section-header"><i class="fas fa-info-circle"></i> Fault Scenario 3: CNC Cooling System</h2>
      <div class="worksheet-content">
        <div class="scenario-info">
          <div class="info-grid">
            <div class="info-item">
              <strong>Company:</strong> Automotive Parts Manufacturing Plant
            </div>
            <div class="info-item">
              <strong>Process:</strong> CNC machine cooling system
            </div>
            <div class="info-item">
              <strong>Shift:</strong> Night shift operator concern
            </div>
            <div class="info-item">
              <strong>Urgency:</strong> Medium - No alarms but operator concern
            </div>
            <div class="info-item">
              <strong>Difficulty:</strong> Intermediate
            </div>
            <div class="info-item">
              <strong>Time:</strong> 25-35 minutes
            </div>
          </div>
        </div>

        <div class="background-section">
          <div class="background-text">
            <div class="scenario-description">
              <h3>Background</h3>
              <p>You maintain the cooling system for CNC machines in an automotive parts plant. The system circulates temperature-controlled coolant to prevent overheating. The night shift operator flags you down.</p>
              
              <p>No alarms. No fault codes. Everything on the HMI looks normal. But he's certain something is off. He points to the return line. Coolant is splashing aggressively into the reservoir, creating turbulence he's never seen before.</p>
              
              <p>A few machines have developed slight condensation near the cooling blocks â€“ "This is not normal" he shouts. The operator has been working here for 15 years and knows the system behavior intimately.</p>
            </div>
          </div>
          
          <div class="background-image">
            <img src="assets/scenarios/cnc-cooling.png" alt="CNC Cooling System">
            <figcaption>CNC Cooling System - Automotive Manufacturing</figcaption>
          </div>
        </div>

        <div class="system-overview">
          <h3>System Status</h3>
          <div class="status-grid">
            <div class="status-item">
              <span class="status-label">System Operation:</span>
              <span class="status-value">RUNNING</span>
            </div>
            <div class="status-item">
              <span class="status-label">Flow Rate:</span>
              <span class="status-value" id="flow-rate">150 L/hour</span>
            </div>
            <div class="status-item">
              <span class="status-label">HMI Status:</span>
              <span class="status-value">NORMAL</span>
            </div>
            <div class="status-item">
              <span class="status-label">Alarm Status:</span>
              <span class="status-value">NONE</span>
            </div>
            <div class="status-item">
              <span class="status-label">Return Line Behavior:</span>
              <span class="status-value warning">AGGRESSIVE SPLASHING</span>
            </div>
            <div class="status-item">
              <span class="status-label">Reservoir Turbulence:</span>
              <span class="status-value warning">UNUSUAL</span>
            </div>
            <div class="status-item">
              <span class="status-label">Machine Condensation:</span>
              <span class="status-value warning">SLIGHT</span>
            </div>
            <div class="status-item">
              <span class="status-label">Operator Concern:</span>
              <span class="status-value warning">HIGH</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Troubleshooting Tips Section -->
    <div class="worksheet-section objectives-section">
      <h2 class="section-header"><i class="fas fa-lightbulb"></i> Troubleshooting Tips</h2>
      <div class="worksheet-content">
        <ul class="objectives-list">
          <li>Check for air entrainment in the cooling system</li>
          <li>Verify pump performance and cavitation conditions</li>
          <li>Inspect system pressure and flow distribution</li>
          <li>Monitor coolant temperature and thermal cycling patterns</li>
        </ul>
      </div>
    </div>

    <!-- Interactive Tools Section - Commented out as requested -->
    <!-- <div class="worksheet-section tools-section">
      <h2 class="section-header"><i class="fas fa-tools"></i> Investigation Tools</h2>
      <div class="worksheet-content">
        <div class="tools-grid">
          <div class="tool-card" onclick="useTool('check_air_entrainment')">
            <i class="fas fa-wind"></i>
            <h3>Check Air Entrainment</h3>
            <p>Inspect for air bubbles and system aeration</p>
          </div>
          <div class="tool-card" onclick="useTool('test_pump_performance')">
            <i class="fas fa-tachometer-alt"></i>
            <h3>Test Pump Performance</h3>
            <p>Check for cavitation and pump efficiency</p>
          </div>
          <div class="tool-card" onclick="useTool('monitor_system_pressure')">
            <i class="fas fa-gauge-high"></i>
            <h3>Monitor System Pressure</h3>
            <p>Check pressure differentials and flow rates</p>
          </div>
          <div class="tool-card" onclick="useTool('analyze_coolant_behavior')">
            <i class="fas fa-thermometer-half"></i>
            <h3>Analyze Coolant Behavior</h3>
            <p>Monitor temperature patterns and thermal cycling</p>
          </div>
        </div>
        <div id="tool-results" class="tool-results"></div>
      </div>
    </div> -->

    <!-- Investigation Results Section -->
    <div class="worksheet-section results-section" id="investigation-results" style="display: none;">
      <h2 class="section-header"><i class="fas fa-clipboard-list"></i> Investigation Results</h2>
      <div class="results-content" id="results-content">
        <!-- Results will be populated by JavaScript -->
      </div>
    </div>

    <!-- Simulation Section - COMMENTED OUT
    <div class="worksheet-section simulation-section">
      <h2 class="section-header"><i class="fas fa-cogs"></i> System Simulation</h2>
      <div class="worksheet-content">
        <div id="hmi-display-panel" class="simulation-container">
          <div class="simulation-loading">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Loading HMI simulation...</p>
          </div>
        </div>
        <div id="plc-io-panel" class="simulation-container" style="margin-top: 20px;">
          <div class="simulation-loading">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Loading PLC I/O simulation...</p>
          </div>
        </div>
        <div id="pump-simulation-panel" class="simulation-container" style="margin-top: 20px;">
          <div class="simulation-loading">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Loading pump simulation...</p>
          </div>
        </div>
        <div id="valve-simulation-panel" class="simulation-container" style="margin-top: 20px;">
          <div class="simulation-loading">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Loading valve simulation...</p>
          </div>
        </div>
      </div>
    </div>
    -->

    <!-- Analysis Section -->
    <div class="worksheet-section questions-section">
      <h2 class="section-header"><i class="fas fa-clipboard-list"></i> Fault Analysis Worksheet</h2>
      <div class="questions-content">
        <div class="analysis-section">
          <h4>Observations:</h4>
          <textarea class="answer-input" data-question="observations" placeholder="Record your observations of the system behavior, readings, and any unusual indicators..."></textarea>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer('observations')">Save Observations</button>
          </div>
        </div>
        
        <div class="analysis-section">
          <h4>Problem:</h4>
          <textarea class="answer-input" data-question="problem" placeholder="Identify the root cause and describe the specific problem affecting the system..."></textarea>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer('problem')">Save Problem Analysis</button>
          </div>
        </div>
        
        <div class="analysis-section">
          <h4>Solution:</h4>
          <textarea class="answer-input" data-question="solution" placeholder="Describe the steps you would take to resolve the issue safely and effectively..."></textarea>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer('solution')">Save Solution</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <style>
    .analysis-section {
      background: #333;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
    }
    
    .analysis-section h4 {
      color: #4CAF50;
      margin-bottom: 10px;
      font-size: 16px;
      font-weight: bold;
      border-bottom: 2px solid #4CAF50;
      padding-bottom: 5px;
    }
    
    .answer-input {
      width: 100%;
      height: 100px;
      padding: 10px;
      border: 1px solid #555;
      border-radius: 4px;
      background: #222;
      color: #FFFFFF;
      resize: vertical;
    }
    
    .submit-question-btn {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
    }
    
    .submit-question-btn:hover {
      background: #45a049;
    }
  </style>
  
  <!-- Simulation Scripts - COMMENTED OUT
  <script src="hmi-simulation.js"></script>
  <script src="plc-simulation.js"></script>
  <script src="pump-simulation.js"></script>
  <script src="valve-simulation.js"></script>
  -->
  <script>
    // Tool usage tracking
    let toolResults = {};
    
    function useTool(toolId) {
      const toolData = {
        'check_air_entrainment': {
          title: 'Air Entrainment Analysis',
          content: 'Visual inspection reveals significant air bubbles in the return line. Coolant appears frothy and aerated. Air entrainment is causing the aggressive splashing behavior. Air is being drawn into the system through a loose connection or seal.',
          icon: 'fas fa-wind'
        },
        'test_pump_performance': {
          title: 'Pump Performance Test Results',
          content: 'Pump efficiency test shows 78% efficiency (normal is 85%). Motor current is 9.8A (normal is 8.5A). Pump is experiencing mild cavitation due to air entrainment. Impeller shows no damage but performance is affected by air in the system.',
          icon: 'fas fa-tachometer-alt'
        },
        'monitor_system_pressure': {
          title: 'System Pressure Analysis',
          content: 'Inlet pressure: 1.5 bar (normal). Outlet pressure: 2.8 bar (elevated). Pressure differential: 1.3 bar (normal is 1.0 bar). Air entrainment is causing increased system pressure and flow turbulence.',
          icon: 'fas fa-gauge-high'
        },
        'analyze_coolant_behavior': {
          title: 'Coolant Behavior Analysis',
          content: 'Temperature monitoring shows normal coolant temperature (22Â°C). However, thermal cycling is irregular due to air entrainment. Condensation on machines is caused by air bubbles creating localized cooling variations.',
          icon: 'fas fa-thermometer-half'
        }
      };
      
      const result = toolData[toolId];
      if (result) {
        toolResults[toolId] = result;
        displayToolResult(toolId, result);
      }
    }
    
    function displayToolResult(toolId, result) {
      const resultsDiv = document.getElementById('tool-results');
      const resultHtml = `
        <div class="tool-result" id="result-${toolId}">
          <div class="result-header">
            <i class="${result.icon}"></i>
            <h3>${result.title}</h3>
          </div>
          <div class="result-content">
            <p>${result.content}</p>
          </div>
        </div>
      `;
      resultsDiv.innerHTML += resultHtml;
    }


    
    // Submit answer
    function submitAnswer(questionType) {
      const input = document.querySelector(`[data-question="${questionType}"]`);
      const answer = input.value.trim();
      
      if (answer) {
        // Save to local storage for backward compatibility
        localStorage.setItem(`fault3_${questionType}`, answer);
        
        // Track with the tracking system if available
        if (typeof trackFaultScenarioAnswer === 'function') {
          trackFaultScenarioAnswer(questionType, answer);
        }
        
        const button = event.target;
        const originalText = button.textContent;
        button.textContent = 'Saved!';
        button.style.background = '#4CAF50';
        
        setTimeout(() => {
          button.textContent = originalText;
        }, 2000);
      } else {
        alert('Please enter content before saving.');
      }
    }

    // Load saved answers
    function loadSavedAnswers() {
      const questionTypes = ['observations', 'problem', 'solution'];
      const worksheetId = 3;
      const type = 'fault';

      // Try new tracking system format first
      if (typeof worksheetTracker !== 'undefined') {
        const progress = worksheetTracker.getWorksheetProgress(worksheetId, type);
        if (progress.answers && Object.keys(progress.answers).length > 0) {
          questionTypes.forEach((questionType, index) => {
            const questionNumber = index + 1; // Convert to 1-based numbering
            const answerData = progress.answers[questionNumber];
            if (answerData) {
              const answerValue = typeof answerData === 'object' ? answerData.value : answerData;
              const input = document.querySelector(`[data-question="${questionType}"]`);
              if (input && answerValue) {
                input.value = answerValue;
              }
            }
          });
          return; // Don't check old format if new format has data
        }
      }

      // Fall back to old format if new format doesn't exist
      questionTypes.forEach(questionType => {
        const saved = localStorage.getItem(`fault3_${questionType}`);
        if (saved) {
          const input = document.querySelector(`[data-question="${questionType}"]`);
          if (input) {
            input.value = saved;
          }
        }
      });
    }
    
    // Load saved answers on page load
    document.addEventListener('DOMContentLoaded', function() {
      loadSavedAnswers();
      
      // Flow rate dithering functionality
      function updateFlowRate() {
        const flowElement = document.getElementById('flow-rate');
        if (flowElement) {
          // Generate random flow rate between 147 and 154 L/hour
          const minFlow = 147;
          const maxFlow = 154;
          const currentFlow = Math.floor(Math.random() * (maxFlow - minFlow + 1)) + minFlow;
          flowElement.textContent = `${currentFlow} L/hour`;
        }
      }
      
      // Start the flow rate dithering every 2-3 seconds for realistic behavior
      function startFlowRateDithering() {
        updateFlowRate(); // Initial update
        setInterval(() => {
          updateFlowRate();
        }, 2000 + Math.random() * 1000); // Random interval between 2-3 seconds
      }
      
      // Start dithering
      startFlowRateDithering();
      
      // Initialize simulations - COMMENTED OUT
      /*
      setTimeout(() => {
        if (typeof initializeHMISimulation === 'function') {
          initializeHMISimulation();
        }
        if (typeof initializePLCSimulation === 'function') {
          initializePLCSimulation();
        }
        if (typeof initializePumpSimulation === 'function') {
          initializePumpSimulation();
        }
        if (typeof initializeValveSimulation === 'function') {
          initializeValveSimulation();
        }
      }, 1000);
      */
    });
  </script>
</body>
</html> 
