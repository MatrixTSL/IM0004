<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Matrix TSL - Fault Scenario 1: Tank Temperature Control System</title>
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="icon" type="image/x-icon" href="assets/icons/matrix-icon.ico">    <script src="worksheet-core.js"></script>
<script src="worksheet-tracking.js"></script>

</head>
<body>
  <!-- Navigation -->
  <nav class="main-navigation">
    <div class="nav-container">
      <div class="nav-logo" onclick="window.location='index.html'" title="Go to Home">
        <img src="assets/matrix-logo.png" alt="Matrix Logo">
      </div>
      <ul class="nav-menu">
        <li class="nav-item">
          <a href="#" onclick="window.location='index.html'" class="nav-link">
            <i class="fas fa-home"></i> HOME
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='cp0539-worksheets.html'" class="nav-link">
            <i class="fas fa-cogs"></i> CP0539
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='cp6773-worksheets.html'" class="nav-link active">
            <i class="fas fa-exclamation-triangle"></i> CP6773
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='tracking-dashboard.html'" class="nav-link">
            <i class="fas fa-chart-line"></i> PROGRESS
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='about.html'" class="nav-link">
            <i class="fas fa-info-circle"></i> ABOUT
          </a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="worksheet-box">
    <!-- Integrated Worksheet Header -->
    <div class="worksheet-header">
      <div class="worksheet-header-content">
        <div class="worksheet-header-left">
          <button class="worksheet-nav-btn worksheet-back-btn" onclick="window.location.href='cp6773-worksheets.html'">
            <i class="fas fa-arrow-left"></i>
            <span>Back to Fault Scenarios</span>
          </button>
        </div>
        <div class="worksheet-header-center">
          <h1 class="worksheet-title">Fault Scenario 1 - Tank Temperature Control System</h1>
        </div>
        <div class="worksheet-header-right">
          <button class="worksheet-nav-btn worksheet-next-btn" onclick="window.location.href='fault-scenario-2.html'">
            <span>Next Scenario</span>
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>
    <!-- Introduction Section -->
    <div class="worksheet-section introduction-section">
      <h2 class="section-header"><i class="fas fa-info-circle"></i> Fault Scenario 1: Tank Temperature Too High</h2>
      <div class="worksheet-content">
        <div class="scenario-info">
          <div class="info-grid">
            <div class="info-item">
              <strong>Scenario:</strong> Tank Temperature Too High
            </div>
            <div class="info-item">
              <strong>Process:</strong> Chemical reaction tank temperature control
            </div>
            <div class="info-item">
              <strong>Shift:</strong> Day shift handover to night shift
            </div>
            <div class="info-item">
              <strong>Urgency:</strong> Medium - Process running hot, quality concerns
            </div>
            <div class="info-item">
              <strong>Difficulty:</strong> Beginner
            </div>
            <div class="info-item">
              <strong>Time:</strong> 20-30 minutes
            </div>
          </div>
        </div>

        <div class="background-section">
          <div class="background-text">
            <div class="scenario-description">
              <h3>Scenario Background</h3>
              <p>You're taking over the night shift at a chemical processing plant. The day shift operator mentions they had some 'sensor issues' earlier and 'made a small adjustment' to keep production running.</p>
              
              <p>The tank temperature controller shows 75°C, which is the correct setpoint for the chemical process. However, you notice the product quality reports show signs of overheating, and the cooling system is working harder than usual.</p>
              
              <p>The day shift operator left a note: 'Added +5°C offset to compensate for slow sensor response. Should be fine now.' But they forgot to mention when this was supposed to be removed.</p>
              
              <p><strong>Industry Context:</strong> A mistake like this is common in industry because operators sometimes add temporary offsets to compensate for sensor errors or delays in heating. If they forget to remove the offset after troubleshooting, the system continues to run with incorrect temperature readings, causing overheating or process failures.</p>
            </div>
          </div>
          
          <div class="background-image">
            <img src="assets/scenarios/titanium-forge.png" alt="Tank Temperature Control System">
            <figcaption>Tank Temperature Control System - Industrial Chemical Processing</figcaption>
          </div>
        </div>

        <div class="system-overview">
          <h3>Initial System Status</h3>
          <div class="status-grid">
            <div class="status-item">
              <span class="status-label">Setpoint:</span>
              <span class="status-value">75°C</span>
            </div>
            <div class="status-item">
              <span class="status-label">Displayed Temperature:</span>
              <span class="status-value">75°C</span>
            </div>
            <div class="status-item">
              <span class="status-label">Actual Temperature:</span>
              <span class="status-value">80°C</span>
            </div>
            <div class="status-item">
              <span class="status-label">Offset Applied:</span>
              <span class="status-value">+5°C</span>
            </div>
            <div class="status-item">
              <span class="status-label">Alarm Status:</span>
              <span class="status-value normal">NORMAL</span>
            </div>
            <div class="status-item">
              <span class="status-label">Quality Issues:</span>
              <span class="status-value warning">YES</span>
            </div>
            <div class="status-item">
              <span class="status-label">Cooling Load:</span>
              <span class="status-value warning">HIGH</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Troubleshooting Tips Section -->
    <div class="worksheet-section objectives-section">
      <h2 class="section-header"><i class="fas fa-lightbulb"></i> Troubleshooting Tips</h2>
      <div class="objectives-content">
        <ul class="objectives-list">
          <li>Always check for temporary offsets or adjustments made by previous shifts</li>
          <li>Verify actual vs displayed values using independent measurement tools</li>
          <li>Look for operator notes or shift handover documentation</li>
          <li>Consider the impact of forgotten adjustments on product quality</li>
        </ul>
      </div>
    </div>

    <!-- Investigation Tools Section -->
    <div class="worksheet-section tools-section">
      <h2 class="section-header"><i class="fas fa-tools"></i> Investigation Tools</h2>
      <div class="tools-content">
        <div class="tools-grid">
          <div class="tool-card" data-tool="check_offset">
            <h4><i class="fas fa-search"></i> Check Controller Offset</h4>
            <p>View current offset settings in temperature controller</p>
            <button class="tool-btn" onclick="useTool('check_offset')">Use Tool</button>
          </div>
          
          <div class="tool-card" data-tool="use_thermometer">
            <h4><i class="fas fa-thermometer-half"></i> Use Portable Thermometer</h4>
            <p>Check actual tank temperature with calibrated instrument</p>
            <button class="tool-btn" onclick="useTool('use_thermometer')">Use Tool</button>
          </div>
          
          <div class="tool-card" data-tool="review_reports">
            <h4><i class="fas fa-file-alt"></i> Review Quality Reports</h4>
            <p>Check recent product quality data for temperature trends</p>
            <button class="tool-btn" onclick="useTool('review_reports')">Use Tool</button>
          </div>
          
          <div class="tool-card" data-tool="adjust_offset">
            <h4><i class="fas fa-sliders-h"></i> Adjust Temperature Offset</h4>
            <p>Remove or modify the temperature offset setting</p>
            <button class="tool-btn" onclick="useTool('adjust_offset')">Use Tool</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Investigation Results Section -->
    <div class="worksheet-section results-section" id="investigation-results" style="display: none;">
      <h2 class="section-header"><i class="fas fa-clipboard-list"></i> Investigation Results</h2>
      <div class="results-content" id="results-content">
        <!-- Results will be populated by JavaScript -->
      </div>
    </div>

    <!-- Analysis Section -->
    <div class="worksheet-section questions-section">
      <h2 class="section-header"><i class="fas fa-clipboard-list"></i> Fault Analysis Worksheet</h2>
      <div class="questions-content">
        <div class="analysis-section">
          <h4>Observations:</h4>
          <textarea class="answer-input" data-question="observations" placeholder="Record your observations of the system behavior, readings, and any unusual indicators..."></textarea>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer('observations')">Save Observations</button>
          </div>
        </div>
        
        <div class="analysis-section">
          <h4>Problem:</h4>
          <textarea class="answer-input" data-question="problem" placeholder="Identify the root cause and describe the specific problem affecting the system..."></textarea>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer('problem')">Save Problem Analysis</button>
          </div>
        </div>
        
        <div class="analysis-section">
          <h4>Solution:</h4>
          <textarea class="answer-input" data-question="solution" placeholder="Describe the steps you would take to resolve the issue safely and effectively..."></textarea>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer('solution')">Save Solution</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Interactive Simulation Section -->
    <div class="worksheet-section simulation-section">
      <h2 class="section-header"><i class="fas fa-cogs"></i> Interactive Temperature Control Simulation</h2>
      <div class="simulation-container">
        <div class="simulation-header">
          <h3><i class="fas fa-thermometer-half"></i> Tank Temperature Control System</h3>
          <p>Experience the fault scenario in real-time. Observe how the temperature offset affects system behavior and practice troubleshooting techniques.</p>
        </div>
        
        <div class="simulation-grid">
          <div class="simulation-left">
            <div class="temperature-visualization">
              <h4>Temperature Display</h4>
              <div class="temp-display-container">
                <div class="temp-gauge-container">
                  <div id="temp-gauge" class="temp-gauge">
                    <div class="gauge-background"></div>
                    <div class="gauge-fill" id="gauge-fill"></div>
                    <div class="gauge-center">
                      <div class="temp-value" id="displayed-temp">75°C</div>
                      <div class="temp-label">Displayed</div>
                    </div>
                  </div>
                </div>
                <div class="temp-indicators">
                  <div class="temp-indicator">
                    <span class="indicator-label">Actual Temperature:</span>
                    <span class="indicator-value" id="actual-temp">80°C</span>
                  </div>
                  <div class="temp-indicator">
                    <span class="indicator-label">Setpoint:</span>
                    <span class="indicator-value" id="setpoint-temp">75°C</span>
                  </div>
                  <div class="temp-indicator">
                    <span class="indicator-label">Offset Applied:</span>
                    <span class="indicator-value" id="offset-value">+5°C</span>
                  </div>
                </div>
              </div>
            </div>
            
            <div class="system-status">
              <h4>System Status</h4>
              <div class="status-grid-sim">
                <div class="status-item-sim">
                  <span class="status-label-sim">Alarm Status:</span>
                  <span class="status-value-sim normal" id="alarm-status">NORMAL</span>
                </div>
                <div class="status-item-sim">
                  <span class="status-label-sim">Quality Issues:</span>
                  <span class="status-value-sim warning" id="quality-status">YES</span>
                </div>
                <div class="status-item-sim">
                  <span class="status-label-sim">Cooling Load:</span>
                  <span class="status-value-sim warning" id="cooling-status">HIGH</span>
                </div>
                <div class="status-item-sim">
                  <span class="status-label-sim">Energy Usage:</span>
                  <span class="status-value-sim warning" id="energy-status">+25%</span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="simulation-right">
            <div class="control-panel">
              <h4>Control Panel</h4>
              <div class="control-group">
                <label for="offset-control">Temperature Offset:</label>
                <input type="range" id="offset-control" min="-10" max="10" value="5" step="0.5">
                <span id="offset-display">+5.0°C</span>
              </div>
              <div class="control-group">
                <label for="setpoint-control">Setpoint:</label>
                <input type="range" id="setpoint-control" min="60" max="90" value="75" step="1">
                <span id="setpoint-display">75°C</span>
              </div>
              <div class="control-buttons">
                <button id="reset-offset" class="control-btn">Reset Offset</button>
                <button id="apply-changes" class="control-btn">Apply Changes</button>
                <button id="reset-simulation" class="control-btn">Reset Simulation</button>
              </div>
            </div>
            
            <div class="troubleshooting-tools">
              <h4>Troubleshooting Tools</h4>
              <div class="tool-buttons">
                <button id="check-offset" class="tool-btn-sim">Check Offset</button>
                <button id="use-thermometer" class="tool-btn-sim">Use Thermometer</button>
                <button id="review-reports" class="tool-btn-sim">Review Reports</button>
                <button id="adjust-offset" class="tool-btn-sim">Adjust Offset</button>
              </div>
            </div>
            
            <div class="diagnostic-log">
              <h4>Diagnostic Log</h4>
              <div id="log-container" class="log-container">
                <div class="log-entry">System initialized with +5°C offset</div>
                <div class="log-entry">Actual temperature: 80°C, Displayed: 75°C</div>
                <div class="log-entry">Quality issues detected in recent batches</div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="simulation-instructions">
          <h4>Instructions</h4>
          <ol>
            <li>Observe the temperature display showing 75°C while the actual temperature is 80°C</li>
            <li>Use the troubleshooting tools to investigate the issue</li>
            <li>Adjust the offset control to see how it affects the displayed vs actual temperature</li>
            <li>Try to resolve the issue by removing the offset</li>
            <li>Monitor the system status indicators for changes</li>
          </ol>
        </div>
      </div>
    </div>
  </div>

  <!-- Styles -->
  <style>
    .scenario-info {
      background: #333;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    /* Simulation Styles */
    .simulation-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin: 20px 0;
    }
    
    .simulation-left, .simulation-right {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .temperature-visualization {
      background: #333;
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid #2196F3;
    }
    
    .temperature-visualization h4 {
      color: #2196F3;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .temp-display-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
    }
    
    .temp-gauge-container {
      position: relative;
      width: 200px;
      height: 200px;
    }
    
    .temp-gauge {
      position: relative;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: conic-gradient(from 0deg, #4CAF50 0deg, #4CAF50 180deg, #666 180deg, #666 360deg);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    }
    
    .gauge-background {
      position: absolute;
      width: 80%;
      height: 80%;
      border-radius: 50%;
      background: #222;
    }
    
    .gauge-fill {
      position: absolute;
      width: 80%;
      height: 80%;
      border-radius: 50%;
      background: conic-gradient(from 0deg, #FF5722 0deg, #FF5722 180deg, transparent 180deg, transparent 360deg);
      transition: all 0.5s ease;
    }
    
    .gauge-center {
      position: relative;
      z-index: 2;
      text-align: center;
      color: #FFFFFF;
    }
    
    .temp-value {
      font-size: 24px;
      font-weight: bold;
      color: #FFFFFF;
    }
    
    .temp-label {
      font-size: 12px;
      color: #AAA;
      margin-top: 5px;
    }
    
    .temp-indicators {
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 100%;
    }
    
    .temp-indicator {
      display: flex;
      justify-content: space-between;
      padding: 8px 12px;
      background: #444;
      border-radius: 4px;
    }
    
    .indicator-label {
      color: #AAA;
      font-weight: bold;
    }
    
    .indicator-value {
      color: #FFFFFF;
      font-weight: bold;
    }
    
    .system-status {
      background: #333;
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid #FF9800;
    }
    
    .system-status h4 {
      color: #FF9800;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .status-grid-sim {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    
    .status-item-sim {
      display: flex;
      justify-content: space-between;
      padding: 8px 12px;
      background: #444;
      border-radius: 4px;
    }
    
    .status-label-sim {
      color: #AAA;
      font-weight: bold;
    }
    
    .status-value-sim {
      color: #FFFFFF;
      font-weight: bold;
    }
    
    .status-value-sim.normal {
      color: #4CAF50;
    }
    
    .status-value-sim.warning {
      color: #FF9800;
    }
    
    .status-value-sim.error {
      color: #F44336;
    }
    
    .control-panel {
      background: #333;
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid #4CAF50;
    }
    
    .control-panel h4 {
      color: #4CAF50;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .control-group {
      margin-bottom: 15px;
    }
    
    .control-group label {
      display: block;
      color: #FFFFFF;
      margin-bottom: 5px;
      font-weight: bold;
    }
    
    .control-group input[type="range"] {
      width: 100%;
      margin-bottom: 5px;
    }
    
    .control-group span {
      color: #2196F3;
      font-weight: bold;
      font-size: 14px;
    }
    
    .control-buttons {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-top: 15px;
    }
    
    .control-btn {
      background: #2196F3;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    
    .control-btn:hover {
      background: #1976D2;
      transform: translateY(-2px);
    }
    
    .troubleshooting-tools {
      background: #333;
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid #9C27B0;
    }
    
    .troubleshooting-tools h4 {
      color: #9C27B0;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .tool-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    
    .tool-btn-sim {
      background: #9C27B0;
      color: white;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      font-weight: bold;
      transition: all 0.3s ease;
    }
    
    .tool-btn-sim:hover {
      background: #7B1FA2;
      transform: translateY(-1px);
    }
    
    .tool-btn-sim:disabled {
      background: #666;
      cursor: not-allowed;
      transform: none;
    }
    
    .diagnostic-log {
      background: #333;
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid #607D8B;
    }
    
    .diagnostic-log h4 {
      color: #607D8B;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .log-container {
      background: #222;
      border: 1px solid #555;
      border-radius: 4px;
      padding: 10px;
      height: 120px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 12px;
    }
    
    .log-entry {
      color: #4CAF50;
      margin-bottom: 5px;
      padding: 2px 0;
    }
    
    .log-entry.warning {
      color: #FF9800;
    }
    
    .log-entry.error {
      color: #F44336;
    }
    
    .log-entry.info {
      color: #2196F3;
    }
    
    .simulation-instructions {
      background: #333;
      padding: 20px;
      border-radius: 8px;
      margin-top: 20px;
      border-left: 4px solid #FF5722;
    }
    
    .simulation-instructions h4 {
      color: #FF5722;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .simulation-instructions ol {
      color: #FFFFFF;
      padding-left: 20px;
    }
    
    .simulation-instructions li {
      margin-bottom: 8px;
      line-height: 1.4;
    }
    
    @media (max-width: 768px) {
      .simulation-grid {
        grid-template-columns: 1fr;
        gap: 20px;
      }
      
      .status-grid-sim {
        grid-template-columns: 1fr;
      }
      
      .tool-buttons {
        grid-template-columns: 1fr;
      }
    }
    
    .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
    }
    
    .info-item {
      color: #FFFFFF;
      padding: 10px;
      background: #444;
      border-radius: 4px;
    }
    
    .scenario-description {
      background: #333;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .scenario-description h3 {
      color: #4CAF50;
      margin-bottom: 15px;
    }
    
    .scenario-description p {
      color: #FFFFFF;
      margin-bottom: 15px;
      line-height: 1.6;
    }
    
    .system-overview {
      background: #333;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    
    .system-overview h3 {
      color: #4CAF50;
      margin-bottom: 15px;
    }
    
    .status-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }
    
    .status-item {
      display: flex;
      justify-content: space-between;
      padding: 10px;
      background: #444;
      border-radius: 4px;
    }
    
    .status-label {
      color: #AAA;
      font-weight: bold;
    }
    
    .status-value {
      color: #FFFFFF;
      font-weight: bold;
    }
    
    .status-value.normal {
      color: #4CAF50;
    }
    
    .status-value.warning {
      color: #FF9800;
    }
    
    .status-value.error {
      color: #F44336;
    }
    
    .system-diagram {
      text-align: center;
      margin: 20px 0;
    }
    
    .system-diagram img {
      max-width: 400px;
      height: auto;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    
    .system-diagram figcaption {
      color: #FFFFFF;
      margin-top: 10px;
      font-style: italic;
    }
    
    .objectives-list {
      list-style: none;
      padding: 0;
    }
    
    .objectives-list li {
      color: #FFFFFF;
      padding: 10px 0;
      border-bottom: 1px solid #555;
      position: relative;
      padding-left: 30px;
    }
    
    .objectives-list li:before {
      content: "✓";
      color: #4CAF50;
      font-weight: bold;
      position: absolute;
      left: 0;
    }
    
    .tools-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }
    
    .tool-card {
      background: #333;
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid #2196F3;
    }
    
    .tool-card h4 {
      color: #2196F3;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .tool-card p {
      color: #FFFFFF;
      margin-bottom: 15px;
    }
    
    .tool-btn {
      background: #2196F3;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: bold;
    }
    
    .tool-btn:hover {
      background: #1976D2;
    }
    
    .tool-btn:disabled {
      background: #666;
      cursor: not-allowed;
    }
    
    .question-item, .analysis-section {
      background: #333;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
    }
    
    .question-item h4, .analysis-section h4 {
      color: #FFFFFF;
      margin-bottom: 10px;
      font-size: 16px;
      font-weight: bold;
    }
    
    .analysis-section h4 {
      color: #4CAF50;
      border-bottom: 2px solid #4CAF50;
      padding-bottom: 5px;
    }
    
    .answer-input {
      width: 100%;
      height: 100px;
      padding: 10px;
      border: 1px solid #555;
      border-radius: 4px;
      background: #222;
      color: #FFFFFF;
      resize: vertical;
    }
    
    .submit-question-btn {
      background: #4CAF50;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
    }
    
    .submit-question-btn:hover {
      background: #45a049;
    }
  </style>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  
  <script>
    // Simulation data
    let simulationData = {
      actualTemperature: 80,
      displayedTemperature: 75,
      setpoint: 75,
      offset: 5,
      qualityIssues: true,
      coolingLoad: 'HIGH',
      energyUsage: '+25%',
      alarmStatus: 'NORMAL'
    };

    // Tool results data
    const toolResults = {
      'check_offset': {
        title: 'Controller Offset Check',
        content: `
          <div class="result-item">
            <h4>Controller Settings Found:</h4>
            <ul>
              <li>Current Offset: +5.0°C</li>
              <li>Offset Applied: 2024-01-15 14:30</li>
              <li>Applied By: Day Shift Operator</li>
              <li>Reason: "Slow sensor response compensation"</li>
              <li>Expiration: Not set</li>
            </ul>
            <p><strong>Analysis:</strong> The offset was applied as a temporary fix but never removed. This is causing the controller to display 75°C while the actual temperature is 80°C.</p>
          </div>
        `
      },
      'use_thermometer': {
        title: 'Portable Thermometer Reading',
        content: `
          <div class="result-item">
            <h4>Actual Temperature Measurement:</h4>
            <ul>
              <li>Portable Thermometer Reading: 80.2°C</li>
              <li>Controller Display: 75.0°C</li>
              <li>Difference: +5.2°C</li>
              <li>Calibration Date: 2024-01-10 (Valid)</li>
            </ul>
            <p><strong>Analysis:</strong> The actual tank temperature is 5.2°C higher than what the controller displays, confirming the offset issue.</p>
          </div>
        `
      },
      'review_reports': {
        title: 'Quality Reports Analysis',
        content: `
          <div class="result-item">
            <h4>Recent Quality Data:</h4>
            <ul>
              <li>Product Quality: Degraded (Last 3 batches)</li>
              <li>Temperature Trend: Increasing over time</li>
              <li>Cooling System Load: 85% (Normal: 40-60%)</li>
              <li>Energy Consumption: +25% above normal</li>
              <li>Operator Notes: "Product seems overcooked"</li>
            </ul>
            <p><strong>Analysis:</strong> The quality issues and increased cooling load confirm the system is running hotter than intended.</p>
          </div>
        `
      },
      'adjust_offset': {
        title: 'Offset Adjustment',
        content: `
          <div class="result-item">
            <h4>Recommended Action:</h4>
            <ol>
              <li>Gradually reduce offset from +5.0°C to 0.0°C</li>
              <li>Monitor actual temperature during adjustment</li>
              <li>Verify system stabilizes at 75°C</li>
              <li>Document the correction</li>
            </ol>
            <p><strong>Safety Note:</strong> Make changes gradually to avoid shocking the process. Monitor for 15-20 minutes after each adjustment.</p>
          </div>
        `
      }
    };

    // Use investigation tool
    function useTool(toolId) {
      const resultsSection = document.getElementById('investigation-results');
      const resultsContent = document.getElementById('results-content');
      const toolCard = document.querySelector(`[data-tool="${toolId}"]`);
      const toolBtn = toolCard.querySelector('.tool-btn');
      
      // Disable the tool button
      toolBtn.disabled = true;
      toolBtn.textContent = 'Used';
      
      // Show results
      const result = toolResults[toolId];
      resultsContent.innerHTML = `
        <h3>${result.title}</h3>
        ${result.content}
      `;
      resultsSection.style.display = 'block';
      
      // Scroll to results
      resultsSection.scrollIntoView({ behavior: 'smooth' });
    }

    // Submit answer
    function submitAnswer(questionType) {
      const input = document.querySelector(`[data-question="${questionType}"]`);
      const answer = input.value.trim();
      
      if (answer) {
        localStorage.setItem(`fault1_${questionType}`, answer);
        
        const button = event.target;
        const originalText = button.textContent;
        button.textContent = 'Saved!';
        button.style.background = '#4CAF50';
        
        setTimeout(() => {
          button.textContent = originalText;
        }, 2000);
      } else {
        alert('Please enter content before saving.');
      }
    }

    // Load saved answers
    function loadSavedAnswers() {
      const questionTypes = ['observations', 'problem', 'solution'];
      questionTypes.forEach(type => {
        const saved = localStorage.getItem(`fault1_${type}`);
        if (saved) {
          const input = document.querySelector(`[data-question="${type}"]`);
          if (input) {
            input.value = saved;
          }
        }
      });
    }

    // Initialize page
    document.addEventListener('DOMContentLoaded', function() {
      loadSavedAnswers();
      initializeSimulation();
    });

    // Simulation Functions
    function initializeSimulation() {
      console.log('Initializing Temperature Control Simulation');
      
      // Initialize controls
      const offsetControl = document.getElementById('offset-control');
      const setpointControl = document.getElementById('setpoint-control');
      const offsetDisplay = document.getElementById('offset-display');
      const setpointDisplay = document.getElementById('setpoint-display');
      
      // Set initial values
      offsetControl.value = simulationData.offset;
      setpointControl.value = simulationData.setpoint;
      updateOffsetDisplay();
      updateSetpointDisplay();
      
      // Add event listeners
      offsetControl.addEventListener('input', function() {
        simulationData.offset = parseFloat(this.value);
        updateOffsetDisplay();
        updateSimulation();
      });
      
      setpointControl.addEventListener('input', function() {
        simulationData.setpoint = parseInt(this.value);
        updateSetpointDisplay();
        updateSimulation();
      });
      
      // Button event listeners
      document.getElementById('reset-offset').addEventListener('click', resetOffset);
      document.getElementById('apply-changes').addEventListener('click', applyChanges);
      document.getElementById('reset-simulation').addEventListener('click', resetSimulation);
      
      // Tool event listeners
      document.getElementById('check-offset').addEventListener('click', () => useSimulationTool('check-offset'));
      document.getElementById('use-thermometer').addEventListener('click', () => useSimulationTool('use-thermometer'));
      document.getElementById('review-reports').addEventListener('click', () => useSimulationTool('review-reports'));
      document.getElementById('adjust-offset').addEventListener('click', () => useSimulationTool('adjust-offset'));
      
      // Initial update
      updateSimulation();
    }

    function updateOffsetDisplay() {
      const offsetDisplay = document.getElementById('offset-display');
      const offset = simulationData.offset;
      offsetDisplay.textContent = `${offset >= 0 ? '+' : ''}${offset.toFixed(1)}°C`;
    }

    function updateSetpointDisplay() {
      const setpointDisplay = document.getElementById('setpoint-display');
      setpointDisplay.textContent = `${simulationData.setpoint}°C`;
    }

    function updateSimulation() {
      // Update displayed temperature (actual - offset)
      simulationData.displayedTemperature = simulationData.actualTemperature - simulationData.offset;
      
      // Update displays
      document.getElementById('displayed-temp').textContent = `${simulationData.displayedTemperature}°C`;
      document.getElementById('actual-temp').textContent = `${simulationData.actualTemperature}°C`;
      document.getElementById('setpoint-temp').textContent = `${simulationData.setpoint}°C`;
      document.getElementById('offset-value').textContent = `${simulationData.offset >= 0 ? '+' : ''}${simulationData.offset}°C`;
      
      // Update gauge
      updateTemperatureGauge();
      
      // Update status indicators
      updateStatusIndicators();
    }

    function updateTemperatureGauge() {
      const gaugeFill = document.getElementById('gauge-fill');
      const displayedTemp = simulationData.displayedTemperature;
      
      // Calculate gauge fill percentage (assuming range 60-90°C)
      const minTemp = 60;
      const maxTemp = 90;
      const percentage = Math.max(0, Math.min(100, ((displayedTemp - minTemp) / (maxTemp - minTemp)) * 100));
      
      // Update gauge fill
      gaugeFill.style.background = `conic-gradient(from 0deg, #FF5722 0deg, #FF5722 ${percentage * 3.6}deg, transparent ${percentage * 3.6}deg, transparent 360deg)`;
    }

    function updateStatusIndicators() {
      const displayedTemp = simulationData.displayedTemperature;
      const actualTemp = simulationData.actualTemperature;
      const setpoint = simulationData.setpoint;
      
      // Update quality status based on temperature deviation
      const tempDeviation = Math.abs(actualTemp - setpoint);
      const qualityStatus = document.getElementById('quality-status');
      if (tempDeviation > 3) {
        qualityStatus.textContent = 'YES';
        qualityStatus.className = 'status-value-sim warning';
      } else {
        qualityStatus.textContent = 'NO';
        qualityStatus.className = 'status-value-sim normal';
      }
      
      // Update cooling load based on actual temperature
      const coolingStatus = document.getElementById('cooling-status');
      if (actualTemp > setpoint + 2) {
        coolingStatus.textContent = 'HIGH';
        coolingStatus.className = 'status-value-sim warning';
      } else {
        coolingStatus.textContent = 'NORMAL';
        coolingStatus.className = 'status-value-sim normal';
      }
      
      // Update energy usage
      const energyStatus = document.getElementById('energy-status');
      if (actualTemp > setpoint + 2) {
        energyStatus.textContent = '+25%';
        energyStatus.className = 'status-value-sim warning';
      } else {
        energyStatus.textContent = 'NORMAL';
        energyStatus.className = 'status-value-sim normal';
      }
    }

    function resetOffset() {
      simulationData.offset = 0;
      document.getElementById('offset-control').value = 0;
      updateOffsetDisplay();
      updateSimulation();
      addLogEntry('Offset reset to 0°C', 'info');
    }

    function applyChanges() {
      addLogEntry('Changes applied to system', 'info');
      addLogEntry(`New offset: ${simulationData.offset >= 0 ? '+' : ''}${simulationData.offset}°C`, 'info');
      addLogEntry(`New setpoint: ${simulationData.setpoint}°C`, 'info');
    }

    function resetSimulation() {
      simulationData = {
        actualTemperature: 80,
        displayedTemperature: 75,
        setpoint: 75,
        offset: 5,
        qualityIssues: true,
        coolingLoad: 'HIGH',
        energyUsage: '+25%',
        alarmStatus: 'NORMAL'
      };
      
      document.getElementById('offset-control').value = 5;
      document.getElementById('setpoint-control').value = 75;
      updateOffsetDisplay();
      updateSetpointDisplay();
      updateSimulation();
      
      // Clear log
      const logContainer = document.getElementById('log-container');
      logContainer.innerHTML = `
        <div class="log-entry">System initialized with +5°C offset</div>
        <div class="log-entry">Actual temperature: 80°C, Displayed: 75°C</div>
        <div class="log-entry">Quality issues detected in recent batches</div>
      `;
      
      addLogEntry('Simulation reset to initial state', 'info');
    }

    function useSimulationTool(toolId) {
      const button = document.getElementById(toolId);
      button.disabled = true;
      
      switch(toolId) {
        case 'check-offset':
          addLogEntry('Checking controller offset settings...', 'info');
          setTimeout(() => {
            addLogEntry(`Current offset: ${simulationData.offset >= 0 ? '+' : ''}${simulationData.offset}°C`, 'info');
            addLogEntry('Offset was applied as temporary fix', 'warning');
            button.disabled = false;
          }, 1000);
          break;
          
        case 'use-thermometer':
          addLogEntry('Using portable thermometer...', 'info');
          setTimeout(() => {
            addLogEntry(`Actual temperature: ${simulationData.actualTemperature}°C`, 'info');
            addLogEntry(`Displayed temperature: ${simulationData.displayedTemperature}°C`, 'info');
            addLogEntry(`Difference: ${simulationData.offset >= 0 ? '+' : ''}${simulationData.offset}°C`, 'warning');
            button.disabled = false;
          }, 1000);
          break;
          
        case 'review-reports':
          addLogEntry('Reviewing quality reports...', 'info');
          setTimeout(() => {
            addLogEntry('Product quality: Degraded (Last 3 batches)', 'warning');
            addLogEntry('Temperature trend: Increasing over time', 'warning');
            addLogEntry('Cooling system load: 85% (Normal: 40-60%)', 'warning');
            button.disabled = false;
          }, 1000);
          break;
          
        case 'adjust-offset':
          addLogEntry('Adjusting temperature offset...', 'info');
          setTimeout(() => {
            addLogEntry('Recommended: Gradually reduce offset to 0°C', 'info');
            addLogEntry('Monitor actual temperature during adjustment', 'info');
            addLogEntry('Verify system stabilizes at setpoint', 'info');
            button.disabled = false;
          }, 1000);
          break;
      }
    }

    function addLogEntry(message, type = 'info') {
      const logContainer = document.getElementById('log-container');
      const logEntry = document.createElement('div');
      logEntry.className = `log-entry ${type}`;
      logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logContainer.appendChild(logEntry);
      logContainer.scrollTop = logContainer.scrollHeight;
    }
  </script>
</body>
</html> 