<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Matrix TSL - Fault Scenario 4: Beverage Factory Flow System</title>
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="icon" type="image/x-icon" href="assets/icons/matrix-icon.ico">    <script src="worksheet-core.js"></script>
<script src="worksheet-tracking.js"></script>

</head>
<body>
  <!-- Navigation -->
  <nav class="main-navigation">
    <div class="nav-container">
      <div class="nav-logo">
        <img src="assets/matrix-logo.png" alt="Matrix Logo">
      </div>
      <ul class="nav-menu">
        <li class="nav-item">
          <a href="#" onclick="window.location='index.html'" class="nav-link">
            <i class="fas fa-home"></i> HOME
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='cp0539-worksheets.html'" class="nav-link">
            <i class="fas fa-cogs"></i> CP0539
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='cp6773-worksheets.html'" class="nav-link active">
            <i class="fas fa-exclamation-triangle"></i> CP6773
          </a>
        </li>
        
        <li class="nav-item">
          <a href="#" onclick="window.location='tracking-dashboard.html'" class="nav-link">
            <i class="fas fa-chart-line"></i> PROGRESS
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='about.html'" class="nav-link">
            <i class="fas fa-info-circle"></i> ABOUT
          </a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="worksheet-box">
    <!-- Integrated Worksheet Header -->
    <div class="worksheet-header">
      <div class="worksheet-header-content">
        <div class="worksheet-header-left">
          <button class="worksheet-nav-btn worksheet-back-btn" onclick="window.location.href='fault-scenario-3.html'">
            <i class="fas fa-arrow-left"></i>
            <span>Previous Scenario</span>
          </button>
        </div>
        <div class="worksheet-header-center">
          <h1 class="worksheet-title">Fault Scenario 4 - Beverage Factory Flow System</h1>
        </div>
        <div class="worksheet-header-right">
          <button class="worksheet-nav-btn worksheet-next-btn" onclick="window.location.href='fault-scenario-5.html'">
            <span>Next Scenario</span>
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>
    <!-- Introduction Section -->
    <div class="worksheet-section introduction-section">
      <h2 class="section-header"><i class="fas fa-info-circle"></i> Fault Scenario 4: Beverage Factory Flow System</h2>
      <div class="worksheet-content">
        <div class="scenario-info">
          <div class="info-grid">
            <div class="info-item">
              <strong>Company:</strong> Large Beverage Factory
            </div>
            <div class="info-item">
              <strong>Process:</strong> Syrup concentration mixing system
            </div>
            <div class="info-item">
              <strong>Shift:</strong> Emergency call-out after maintenance team left
            </div>
            <div class="info-item">
              <strong>Urgency:</strong> High - Production stopped, system slams to halt
            </div>
            <div class="info-item">
              <strong>Difficulty:</strong> Advanced
            </div>
            <div class="info-item">
              <strong>Time:</strong> 30-40 minutes
            </div>
          </div>
        </div>

        <div class="background-section">
          <div class="background-text">
            <div class="scenario-description">
              <h3>Background</h3>
              <p>A large beverage factory depends on your flow system to mix syrup concentrations. The maintenance team left early. You get called in.</p>
              
              <p>The system starts, runs for a few seconds then slams to a halt. Management have had consultants on the phone who reckon it's an electrical noise issue.</p>
              
              <p>The maintenance manager had a quick look for a few seconds and everything looks good, you've been asked to investigate further.</p>
              
              <p><strong>Industry Context:</strong> In beverage manufacturing, flow systems are critical for precise syrup mixing and product consistency. Electrical noise issues can cause intermittent faults that are difficult to diagnose but can shut down entire production lines.</p>
            </div>
          </div>
          
          <div class="background-image">
            <img src="assets/scenarios/server-room.png" alt="Beverage Factory Flow System">
            <figcaption>Beverage Factory Flow System - Syrup Mixing</figcaption>
          </div>
        </div>

        <div class="system-overview">
          <h3>System Status</h3>
          <div class="status-grid">
            <div class="status-item">
              <span class="status-label">System Operation:</span>
              <span class="status-value error">STOPPED</span>
            </div>
            <div class="status-item">
              <span class="status-label">Run Time:</span>
              <span class="status-value warning">FEW SECONDS</span>
            </div>
            <div class="status-item">
              <span class="status-label">Production Status:</span>
              <span class="status-value error">HALTED</span>
            </div>
            <div class="status-item">
              <span class="status-label">Electrical Status:</span>
              <span class="status-value">NORMAL</span>
            </div>
            <div class="status-item">
              <span class="status-label">Flow System:</span>
              <span class="status-value error">SLAMS TO HALT</span>
            </div>
            <div class="status-item">
              <span class="status-label">Consultant Diagnosis:</span>
              <span class="status-value warning">ELECTRICAL NOISE</span>
            </div>
            <div class="status-item">
              <span class="status-label">Maintenance Check:</span>
              <span class="status-value">VISUALLY OK</span>
            </div>
            <div class="status-item">
              <span class="status-label">Investigation Required:</span>
              <span class="status-value warning">FURTHER ANALYSIS</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Troubleshooting Tips Section -->
    <div class="worksheet-section objectives-section">
      <h2 class="section-header"><i class="fas fa-lightbulb"></i> Troubleshooting Tips</h2>
      <div class="worksheet-content">
        <ul class="objectives-list">
          <li>Check for electrical noise interference and grounding issues</li>
          <li>Inspect flow sensor calibration and signal integrity</li>
          <li>Verify system startup sequence and timing</li>
          <li>Monitor for intermittent faults and system behavior patterns</li>
        </ul>
      </div>
    </div>

    <!-- Interactive Tools Section -->
    <div class="worksheet-section tools-section">
      <h2 class="section-header"><i class="fas fa-tools"></i> Investigation Tools</h2>
      <div class="worksheet-content">
        <div class="tools-grid">
          <div class="tool-card" onclick="useTool('check_electrical_noise')">
            <i class="fas fa-bolt"></i>
            <h3>Check Electrical Noise</h3>
            <p>Inspect for interference and grounding issues</p>
          </div>
          <div class="tool-card" onclick="useTool('test_flow_sensor')">
            <i class="fas fa-microchip"></i>
            <h3>Test Flow Sensor</h3>
            <p>Verify sensor calibration and signal integrity</p>
          </div>
          <div class="tool-card" onclick="useTool('analyze_startup_sequence')">
            <i class="fas fa-play-circle"></i>
            <h3>Analyze Startup Sequence</h3>
            <p>Check system initialization and timing</p>
          </div>
          <div class="tool-card" onclick="useTool('monitor_system_behavior')">
            <i class="fas fa-chart-line"></i>
            <h3>Monitor System Behavior</h3>
            <p>Track intermittent faults and patterns</p>
          </div>
        </div>
        <div id="tool-results" class="tool-results"></div>
      </div>
    </div>

    <!-- Investigation Results Section -->
    <div class="worksheet-section results-section" id="investigation-results" style="display: none;">
      <h2 class="section-header"><i class="fas fa-clipboard-list"></i> Investigation Results</h2>
      <div class="results-content" id="results-content">
        <!-- Results will be populated by JavaScript -->
      </div>
    </div>

    <!-- Simulation Section - COMMENTED OUT
    <div class="worksheet-section simulation-section">
      <h2 class="section-header"><i class="fas fa-cogs"></i> System Simulation</h2>
      <div class="worksheet-content">
        <div id="server-room-simulation" class="simulation-container">
          <div class="simulation-loading">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Loading server room cooling simulation...</p>
          </div>
        </div>
        <div id="hmi-panel" class="simulation-container" style="margin-top: 20px;"></div>
        <div id="plc-io-panel" class="simulation-container" style="margin-top: 20px;"></div>
        <div id="fault-injection-panel" class="simulation-panel" style="margin-top: 20px;"></div>
        <div id="diagnostic-challenges-panel" class="simulation-panel" style="margin-top: 20px;"></div>
      </div>
    </div>
    -->

    <!-- Analysis Section -->
    <div class="worksheet-section questions-section">
      <h2 class="section-header"><i class="fas fa-clipboard-list"></i> Fault Analysis Worksheet</h2>
      <div class="questions-content">
        <div class="analysis-section">
          <h4>Observations:</h4>
          <textarea class="answer-input" data-question="observations" placeholder="Record your observations of the system behavior, readings, and any unusual indicators..."></textarea>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer('observations')">Save Observations</button>
          </div>
        </div>
        
        <div class="analysis-section">
          <h4>Problem:</h4>
          <textarea class="answer-input" data-question="problem" placeholder="Identify the root cause and describe the specific problem affecting the system..."></textarea>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer('problem')">Save Problem Analysis</button>
          </div>
        </div>
        
        <div class="analysis-section">
          <h4>Solution:</h4>
          <textarea class="answer-input" data-question="solution" placeholder="Describe the steps you would take to resolve the issue safely and effectively..."></textarea>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer('solution')">Save Solution</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Simulation Scripts - COMMENTED OUT
  <script src="hmi-simulation.js"></script>
  <script src="plc-simulation.js"></script>
  <script src="pump-simulation.js"></script>
  <script src="valve-simulation.js"></script>
  -->
  <script>
    // Tool usage tracking
    let toolResults = {};
    
    function useTool(toolId) {
      const toolData = {
        'check_electrical_noise': {
          title: 'Electrical Noise Analysis',
          content: 'Oscilloscope analysis reveals significant electrical noise on the flow sensor signal line. Noise amplitude is 2.5V peak-to-peak (normal is 0.1V). The noise is causing false readings that trigger system shutdown. Grounding inspection shows loose connection at sensor junction box.',
          icon: 'fas fa-bolt'
        },
        'test_flow_sensor': {
          title: 'Flow Sensor Test Results',
          content: 'Flow sensor calibration test shows sensor is accurate when isolated from electrical noise. Signal integrity test reveals intermittent signal dropout during startup. Sensor output becomes unstable after 3-5 seconds of operation, coinciding with system shutdown.',
          icon: 'fas fa-microchip'
        },
        'analyze_startup_sequence': {
          title: 'Startup Sequence Analysis',
          content: 'System startup timing analysis shows normal initialization for first 3 seconds. At 3.2 seconds, flow sensor signal becomes erratic due to electrical interference. System shutdown occurs at 3.5 seconds when flow reading exceeds safety threshold.',
          icon: 'fas fa-play-circle'
        },
        'monitor_system_behavior': {
          title: 'System Behavior Monitoring',
          content: 'Continuous monitoring reveals intermittent electrical noise that correlates with nearby equipment startup. The noise pattern matches the timing of the flow system shutdown. Electrical interference is causing false flow readings that trigger safety shutdown.',
          icon: 'fas fa-chart-line'
        }
      };
      
      const result = toolData[toolId];
      if (result) {
        toolResults[toolId] = result;
        displayToolResult(toolId, result);
      }
    }
    
    function displayToolResult(toolId, result) {
      const resultsDiv = document.getElementById('tool-results');
      const resultHtml = `
        <div class="tool-result" id="result-${toolId}">
          <div class="result-header">
            <i class="${result.icon}"></i>
            <h3>${result.title}</h3>
          </div>
          <div class="result-content">
            <p>${result.content}</p>
          </div>
        </div>
      `;
      resultsDiv.innerHTML += resultHtml;
    }


    
    // Submit answer
    function submitAnswer(questionType) {
      const input = document.querySelector(`[data-question="${questionType}"]`);
      const answer = input.value.trim();
      
      if (answer) {
        // Save to local storage for backward compatibility
        localStorage.setItem(`fault4_${questionType}`, answer);
        
        // Track with the tracking system if available
        if (typeof trackFaultScenarioAnswer === 'function') {
          trackFaultScenarioAnswer(questionType, answer);
        }
        
        const button = event.target;
        const originalText = button.textContent;
        button.textContent = 'Saved!';
        button.style.background = '#4CAF50';
        
        setTimeout(() => {
          button.textContent = originalText;
        }, 2000);
      } else {
        alert('Please enter content before saving.');
      }
    }

    // Load saved answers
    function loadSavedAnswers() {
      const questionTypes = ['observations', 'problem', 'solution'];
      questionTypes.forEach(type => {
        const saved = localStorage.getItem(`fault4_${type}`);
        if (saved) {
          const input = document.querySelector(`[data-question="${type}"]`);
          if (input) {
            input.value = saved;
          }
        }
      });
    }
    
    // Load saved answers on page load
    document.addEventListener('DOMContentLoaded', function() {
      loadSavedAnswers();
      
      // Initialize simulations - COMMENTED OUT
      /*
      setTimeout(() => {
        if (typeof initializeHMISimulation === 'function') {
          initializeHMISimulation();
        }
        if (typeof initializePLCSimulation === 'function') {
          initializePLCSimulation();
        }
        if (typeof initializePumpSimulation === 'function') {
          initializePumpSimulation();
        }
        if (typeof initializeValveSimulation === 'function') {
          initializeValveSimulation();
        }
      }, 1000);
      */
    });
  </script>
</body>
</html> 
