<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Matrix TSL - Emergency Stop System Maintenance</title>
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="icon" type="image/x-icon" href="assets/icons/matrix-icon.ico">
  <script src="worksheet-core.js"></script>
  <script src="worksheet-tracking.js"></script>

</head>
<body>
  <!-- Navigation -->
  <nav class="main-navigation">
    <div class="nav-container">
      <div class="nav-logo">
        <img src="assets/matrix-logo.png" alt="Matrix Logo">
      </div>
      <ul class="nav-menu" id="nav-menu">
        <li class="nav-item">
          <a href="#" onclick="window.location='index.html'" class="nav-link">
            <i class="fas fa-home"></i> HOME
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='cp0539-worksheets.html'" class="nav-link">
            <i class="fas fa-cogs"></i> CP0539
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='cp6773-worksheets.html'" class="nav-link">
            <i class="fas fa-exclamation-triangle"></i> CP6773
          </a>
        </li>
        
        <li class="nav-item">
          <a href="#" onclick="window.location='tracking-dashboard.html'" class="nav-link">
            <i class="fas fa-chart-line"></i> PROGRESS
          </a>
        </li><li class="nav-item">
          <a href="#" onclick="window.location='settings.html'" class="nav-link">
            <i class="fas fa-gear"></i> SETTINGS
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='about.html'" class="nav-link">
            <i class="fas fa-info-circle"></i> ABOUT
          </a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="worksheet-box">
    <!-- Integrated Worksheet Header -->
    <div class="worksheet-header">
      <div class="worksheet-header-content">
        <div class="worksheet-header-left">
          <button class="worksheet-nav-btn worksheet-back-btn" onclick="window.location.href='worksheet-1.html'">
            <i class="fas fa-arrow-left"></i>
            <span>Previous Worksheet</span>
          </button>
        </div>
        <div class="worksheet-header-center">
          <h1 class="worksheet-title">Worksheet 2 - Emergency Stop System Maintenance</h1>
        </div>
        <div class="worksheet-header-right">
          <button class="worksheet-nav-btn worksheet-next-btn" onclick="window.location.href='worksheet-3.html'">
            <span>Next Worksheet</span>
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>
    <!-- Introduction Section -->
    <div class="worksheet-section introduction-section">
      <h2 class="section-header"><i class="fas fa-info-circle"></i> 1. Introduction</h2>
      <div class="worksheet-content">
        <div class="introduction-content-wrapper">
          <div class="introduction-text">
            <p>Emergency stop systems are critical safety devices designed to immediately shut down equipment in dangerous situations. These systems must be 100% reliable because lives depend on them functioning properly when needed.</p>
          </div>
          <div class="introduction-image">
            <div class="system-diagram">
              <img src="assets/maintenance/emergency-stops.png" alt="Emergency Stop System">
              <figcaption>Emergency Stop System Components</figcaption>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Over To You Section -->
    <div class="worksheet-section over-to-you-section">
      <h2 class="section-header"><i class="fas fa-hands-helping"></i> 2. Over To You</h2>
      <div class="worksheet-content">
        <p><strong>Examine the emergency stop systems located throughout the facility. These critical safety devices must be tested regularly to ensure they function properly when needed.</strong></p>
        
        <div class="steps-container">
          <div class="step-card" data-step="1">
            <div class="step-number">1</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Visual Inspection</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Check each E-stop button for physical damage, proper mounting, and clear labeling. Ensure the button is not stuck or damaged.</p>
            </div>
          </div>
          
          <div class="step-card" data-step="2">
            <div class="step-number">2</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Mechanical Test</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Press each E-stop button to verify it latches properly and requires intentional rotation to reset.</p>
            </div>
          </div>
          
          <div class="step-card" data-step="3">
            <div class="step-number">3</div>
            <div class="step-content">
              <div class="step-header">
                <h4>Circuit Verification</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Use a multimeter to verify the E-stop contacts open properly when activated and close when reset.</p>
            </div>
          </div>
          
          <div class="step-card" data-step="4">
            <div class="step-number">4</div>
            <div class="step-content">
              <div class="step-header">
                <h4>System Response Test</h4>
                <label class="step-checkbox">
                  <input type="checkbox" class="step-complete-checkbox">
                  <span class="checkmark"></span>
                </label>
              </div>
              <p>Test that the system properly shuts down when E-stop is activated and requires proper reset sequence to restart.</p>
            </div>
          </div>
        </div>
      </div>
    </div>



    <!-- So What Section -->
    <div class="worksheet-section so-what-section">
      <h2 class="section-header"><i class="fas fa-lightbulb"></i> 3. So What?</h2>
      <div class="so-what-content">
        <p>Emergency stop systems are the last line of defense in industrial safety. They must be 100% reliable because lives depend on them. Understanding how they work and how to maintain them is crucial for any maintenance technician.</p>
        
        <div class="key-point">
          <i class="fas fa-shield-alt"></i>
          <div>
            <strong>Safety First</strong>
            <p>E-stop systems are designed to fail safe - if anything goes wrong with the system, it defaults to the stopped state to protect people and equipment.</p>
          </div>
        </div>
        
        <div class="key-point">
          <i class="fas fa-clone"></i>
          <div>
            <strong>Redundancy</strong>
            <p>Critical systems often have multiple E-stop buttons and redundant safety circuits to ensure the system can always be stopped, even if one component fails.</p>
          </div>
        </div>
        
        <div class="key-point">
          <i class="fas fa-clipboard-check"></i>
          <div>
            <strong>Compliance</strong>
            <p>E-stop systems must meet strict safety standards (like ISO 13850) and require regular testing and documentation to maintain safety certification.</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Questions Section -->
    <div class="worksheet-section questions-section">
      <h2 class="section-header"><i class="fas fa-question-circle"></i> 4. Questions & Answers</h2>
      <div class="questions-content">
        <div class="instructions">
          <strong>Instructions:</strong> Answer each question based on your observations and understanding of emergency stop systems.
        </div>
        
        <div class="question-item" data-question="1">
          <h4>Question 1: What is the main purpose of an Emergency Stop (E-Stop)?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-1" value="A" class="option-radio">
              <span class="option-text">A) To quickly stop a machine or system in an emergency to protect people and equipment</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-1" value="B" class="option-radio">
              <span class="option-text">B) To slow down the system gradually</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-1" value="C" class="option-radio">
              <span class="option-text">C) To display warning messages</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-1" value="D" class="option-radio">
              <span class="option-text">D) To restart the system automatically</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(1)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> A) To quickly stop a machine or system in an emergency to protect people and equipment.
          </div>
        </div>
        
        <div class="question-item" data-question="2">
          <h4>Question 2: How do you reset the E-Stop after it has been pressed?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-2" value="A" class="option-radio">
              <span class="option-text">A) Twist the E-Stop anti-clockwise, then press the blue reset button or the HMI reset button</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-2" value="B" class="option-radio">
              <span class="option-text">B) Simply press the E-Stop button again</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-2" value="C" class="option-radio">
              <span class="option-text">C) Turn off the main power switch</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-2" value="D" class="option-radio">
              <span class="option-text">D) Wait for the system to reset automatically</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(2)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> A) Twist the E-Stop anti-clockwise, then press the blue reset button or the HMI reset button.
          </div>
        </div>
        
        <div class="question-item" data-question="3">
          <h4>Question 3: What makes an E-Stop more reliable than a normal stop button?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-3" value="A" class="option-radio">
              <span class="option-text">A) It has two contact channels; both must be closed for operation, and either opening will stop the system, this redundancy ensures safety</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-3" value="B" class="option-radio">
              <span class="option-text">B) It is larger and more visible</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-3" value="C" class="option-radio">
              <span class="option-text">C) It uses higher voltage</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-3" value="D" class="option-radio">
              <span class="option-text">D) It is made of stronger materials</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(3)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> A) It has two contact channels; both must be closed for operation, and either opening will stop the system, this redundancy ensures safety.
          </div>
        </div>
        
        <div class="question-item" data-question="4">
          <h4>Question 4: When should an E-Stop be used?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-4" value="A" class="option-radio">
              <span class="option-text">A) Only during emergencies, not for regular stopping of the machine</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-4" value="B" class="option-radio">
              <span class="option-text">B) For normal shutdown procedures</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-4" value="C" class="option-radio">
              <span class="option-text">C) To pause the system temporarily</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-4" value="D" class="option-radio">
              <span class="option-text">D) To change system settings</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(4)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> A) Only during emergencies, not for regular stopping of the machine.
          </div>
        </div>
        
        <div class="question-item" data-question="5">
          <h4>Question 5: Why is it important to regularly inspect the E-Stop?</h4>
          <div class="multiple-choice-options">
            <label class="option-label">
              <input type="radio" name="question-5" value="A" class="option-radio">
              <span class="option-text">A) To ensure it is free from damage or faults and will work properly when needed</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-5" value="B" class="option-radio">
              <span class="option-text">B) To clean the button surface</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-5" value="C" class="option-radio">
              <span class="option-text">C) To change the button color</span>
            </label>
            <label class="option-label">
              <input type="radio" name="question-5" value="D" class="option-radio">
              <span class="option-text">D) To adjust the button position</span>
            </label>
          </div>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer(5)">Submit Answer</button>
          </div>
          <div class="correct-answer" style="display: none; margin-top: 15px; padding: 15px; background: #1a2f1a; border-radius: 4px; border-left: 3px solid #4CAF50;">
            <strong style="color: #4CAF50;">Correct Answer:</strong> A) To ensure it is free from damage or faults and will work properly when needed.
          </div>
        </div>
      </div>
    </div>

    <!-- Emergency Stop Simulation -->
    <div class="simulation-section">
      <h2 class="section-header"><i class="fas fa-hand-paper"></i> 5. Emergency Stop System Simulation</h2>
      <div id="emergency-stop-panel" class="simulation-container">
        <div class="estop-display">
          <div class="estop-button-container">
            <div class="estop-button" id="estop-btn">
              <div class="estop-button-top">EMERGENCY</div>
              <div class="estop-button-bottom">STOP</div>
            </div>
            <div class="estop-status" id="estop-status">NORMAL</div>
          </div>
          
          <div class="system-status">
            <div class="status-item">
              <span class="status-label">System Power:</span>
              <span class="status-value" id="system-power">ON</span>
            </div>
            <div class="status-item">
              <span class="status-label">Safety Circuit:</span>
              <span class="status-value" id="safety-circuit">CLOSED</span>
            </div>
            <div class="status-item">
              <span class="status-label">Equipment Status:</span>
              <span class="status-value" id="equipment-status">RUNNING</span>
            </div>
          </div>
          
          <div class="control-panel">
            <button id="reset-btn" class="reset-button" disabled>RESET SYSTEM</button>
            <button id="test-btn" class="test-button">TEST E-STOP</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    let estopPressed = false;
    
    document.addEventListener('DOMContentLoaded', function() {
      initializeEmergencyStopSimulation();
      initializeStepTracking();
      loadSavedAnswers();
    });
    
    function initializeEmergencyStopSimulation() {
      const estopBtn = document.getElementById('estop-btn');
      const resetBtn = document.getElementById('reset-btn');
      const testBtn = document.getElementById('test-btn');
      
      // E-stop button click
      estopBtn.addEventListener('click', function() {
        activateEmergencyStop();
      });
      
      // Reset button click
      resetBtn.addEventListener('click', function() {
        resetSystem();
      });
      
      // Test button click
      testBtn.addEventListener('click', function() {
        testEmergencyStop();
      });
    }
    
    function activateEmergencyStop() {
      estopPressed = true;
      
      // Visual feedback
      document.getElementById('estop-btn').classList.add('pressed');
      document.getElementById('estop-status').textContent = 'EMERGENCY STOP ACTIVATED';
      document.getElementById('estop-status').classList.add('emergency');
      
      // System status updates
      document.getElementById('system-power').textContent = 'OFF';
      document.getElementById('system-power').classList.add('alarm');
      document.getElementById('safety-circuit').textContent = 'OPEN';
      document.getElementById('safety-circuit').classList.add('alarm');
      document.getElementById('equipment-status').textContent = 'STOPPED';
      document.getElementById('equipment-status').classList.add('alarm');
      
      // Enable reset button
      document.getElementById('reset-btn').disabled = false;
      
      console.log('Emergency stop activated!');
    }
    
    function resetSystem() {
      if (!estopPressed) return;
      
      estopPressed = false;
      
      // Visual feedback
      document.getElementById('estop-btn').classList.remove('pressed');
      document.getElementById('estop-status').textContent = 'NORMAL';
      document.getElementById('estop-status').classList.remove('emergency');
      
      // System status updates
      document.getElementById('system-power').textContent = 'ON';
      document.getElementById('system-power').classList.remove('alarm');
      document.getElementById('safety-circuit').textContent = 'CLOSED';
      document.getElementById('safety-circuit').classList.remove('alarm');
      document.getElementById('equipment-status').textContent = 'RUNNING';
      document.getElementById('equipment-status').classList.remove('alarm');
      
      // Disable reset button
      document.getElementById('reset-btn').disabled = true;
      
      console.log('System reset completed');
    }
    
    function testEmergencyStop() {
      alert('E-stop test procedure:\n\n1. Press the emergency stop button\n2. Verify all equipment stops immediately\n3. Check that reset button becomes active\n4. Twist and pull the E-stop to reset\n5. Press system reset to restore operation');
    }
    
    function initializeStepTracking() {
      const checkboxes = document.querySelectorAll('.step-complete-checkbox');
      checkboxes.forEach((checkbox, index) => {
        checkbox.addEventListener('change', function() {
          localStorage.setItem(`worksheet2_step${index + 1}`, this.checked);
        });
        
        const saved = localStorage.getItem(`worksheet2_step${index + 1}`);
        if (saved === 'true') {
          checkbox.checked = true;
        }
      });
    }
    
    function submitAnswer(questionNumber) {
      const answerInput = document.querySelector(`[data-question="${questionNumber}"]`);
      if (!answerInput) return;
      
      const selectedOption = document.querySelector(`input[name="question-${questionNumber}"]:checked`);
      if (!selectedOption) {
        alert('Please select an answer before submitting.');
        return;
      }
      
      const answer = selectedOption.value;
      
      // Save with enhanced tracking
      worksheetTracker.saveAnswer(2, questionNumber, answer, 'maintenance');
      
      // Define correct answers for worksheet 2
      const correctAnswers = {
            "1": "A",
            "2": "A",
            "3": "A",
            "4": "A",
            "5": "A"
      };
      
      // Apply visual feedback
      const allOptions = answerInput.querySelectorAll('.option-label');
      const correctAnswer = correctAnswers[questionNumber];
      
      allOptions.forEach(option => {
        const radio = option.querySelector('.option-radio');
        const optionValue = radio.value;
        
        if (optionValue === correctAnswer) {
          option.classList.add('correct');
        } else if (optionValue === answer && answer !== correctAnswer) {
          option.classList.add('incorrect');
        }
      });
      
      // Mark question as submitted to disable further interaction
      answerInput.classList.add('submitted');
      
      // Show feedback on button
      const submitBtn = answerInput.querySelector('.submit-question-btn');
      if (submitBtn) {
        const originalText = submitBtn.textContent;
        submitBtn.textContent = answer === correctAnswer ? 'Correct!' : 'Incorrect!';
        submitBtn.style.background = answer === correctAnswer ? '#4CAF50' : '#f44336';
        
        // Add incorrect class for enhanced styling
        if (answer !== correctAnswer) {
          submitBtn.classList.add('incorrect');
        }
        
        setTimeout(() => {
          submitBtn.textContent = originalText;
          submitBtn.style.background = '#4CAF50';
          submitBtn.classList.remove('incorrect');
        }, 2000);
      }
      
      // Show correct answer if available
      const correctAnswerDiv = answerInput.querySelector('.correct-answer');
      if (correctAnswerDiv) {
        correctAnswerDiv.style.display = 'block';
      }
    }
    function loadSavedAnswers() {
      // This function is now handled by the tracking system
    }
  </script>
  
  <!-- Bottom Navigation -->
  <div class="worksheet-bottom-nav">
    <div class="worksheet-header-content">
      <div class="worksheet-header-left">
        <button class="worksheet-nav-btn worksheet-back-btn" onclick="window.location.href='worksheet-1.html'">
          <i class="fas fa-arrow-left"></i>
          <span>Previous Worksheet</span>
        </button>
      </div>
      <div class="worksheet-header-center">
        <h1 class="worksheet-title">Worksheet 2 - Emergency Stop System Maintenance</h1>
      </div>
      <div class="worksheet-header-right">
        <button class="worksheet-nav-btn worksheet-next-btn" onclick="window.location.href='worksheet-3.html'">
          <span>Next Worksheet</span>
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>
  
</body>
</html> 