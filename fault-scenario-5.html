<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Matrix TSL - Fault Scenario 5: Brine Flow Control System</title>
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
  <link rel="icon" type="image/x-icon" href="assets/icons/matrix-icon.ico">    <script src="worksheet-core.js"></script>
<script src="worksheet-tracking.js"></script>

</head>
<body>
  <!-- Navigation -->
  <nav class="main-navigation">
    <div class="nav-container">
      <div class="nav-logo">
        <img src="assets/matrix-logo.png" alt="Matrix Logo">
      </div>
      <ul class="nav-menu">
        <li class="nav-item">
          <a href="#" onclick="window.location='index.html'" class="nav-link">
            <i class="fas fa-home"></i> HOME
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='cp0539-worksheets.html'" class="nav-link">
            <i class="fas fa-cogs"></i> CP0539
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='cp6773-worksheets.html'" class="nav-link active">
            <i class="fas fa-exclamation-triangle"></i> CP6773
          </a>
        </li>
        
        <li class="nav-item">
          <a href="#" onclick="window.location='tracking-dashboard.html'" class="nav-link">
            <i class="fas fa-chart-line"></i> PROGRESS
          </a>
        </li>
        <li class="nav-item">
          <a href="#" onclick="window.location='about.html'" class="nav-link">
            <i class="fas fa-info-circle"></i> ABOUT
          </a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="worksheet-box">
    <!-- Integrated Worksheet Header -->
    <div class="worksheet-header">
      <div class="worksheet-header-content">
        <div class="worksheet-header-left">
          <button class="worksheet-nav-btn worksheet-back-btn" onclick="window.location.href='fault-scenario-4.html'">
            <i class="fas fa-arrow-left"></i>
            <span>Previous Scenario</span>
          </button>
        </div>
        <div class="worksheet-header-center">
          <h1 class="worksheet-title">Fault Scenario 5 - Brine Flow Control System</h1>
        </div>
        <div class="worksheet-header-right">
          <button class="worksheet-nav-btn worksheet-next-btn" onclick="window.location.href='fault-scenario-6.html'">
            <span>Next Scenario</span>
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>
    <!-- Introduction Section -->
    <div class="worksheet-section introduction-section">
      <h2 class="section-header"><i class="fas fa-info-circle"></i> Scenario Overview</h2>
      <div class="worksheet-content">
        <div class="scenario-info">
          <div class="info-grid">
            <div class="info-item">
              <strong>Company:</strong> Northern Potash Mining Ltd.
            </div>
            <div class="info-item">
              <strong>Process:</strong> Brine injection system for potash extraction
            </div>
            <div class="info-item">
              <strong>Shift:</strong> Day shift operation
            </div>
            <div class="info-item">
              <strong>Urgency:</strong> Medium - Production efficiency declining
            </div>
            <div class="info-item">
              <strong>Difficulty:</strong> Advanced
            </div>
            <div class="info-item">
              <strong>Time:</strong> 35-45 minutes
            </div>
          </div>
        </div>

        <div class="background-section">
          <div class="background-text">
            <div class="scenario-description">
              <h3>Background</h3>
              <p>At a potash mine, the brine injection system's flow control loop is showing inconsistent behavior.</p>
              
              <p>Operators report that the flow rate fluctuates despite a constant setpoint, affecting the extraction process efficiency.</p>
              
              <p>The control valve position indicator shows frequent movement, suggesting the system is 'hunting' for the correct position.</p>
              
              <p>Pressure sensors upstream and downstream of the control valve show stable readings, ruling out pressure-related issues.</p>
            </div>
          </div>
          
          <div class="background-image">
            <img src="assets/scenarios/brine-system.png" alt="Brine Injection System">
            <figcaption>Brine Injection System - Potash Mining</figcaption>
          </div>
        </div>

        <div class="system-overview">
          <h3>System Status</h3>
          <div class="status-grid">
            <div class="status-item">
              <span class="status-label">Flow Setpoint:</span>
              <span class="status-value">250 L/min</span>
            </div>
            <div class="status-item">
              <span class="status-label">Current Flow:</span>
              <span class="status-value">248 L/min</span>
            </div>
            <div class="status-item">
              <span class="status-label">Flow Variation:</span>
              <span class="status-value warning">±15 L/min</span>
            </div>
            <div class="status-item">
              <span class="status-label">Valve Position:</span>
              <span class="status-value">67%</span>
            </div>
            <div class="status-item">
              <span class="status-label">Valve Movement:</span>
              <span class="status-value warning">HUNTING</span>
            </div>
            <div class="status-item">
              <span class="status-label">Brine Temperature:</span>
              <span class="status-value">45°C</span>
            </div>
            <div class="status-item">
              <span class="status-label">Control Stability:</span>
              <span class="status-value warning">POOR</span>
            </div>
            <div class="status-item">
              <span class="status-label">Extraction Efficiency:</span>
              <span class="status-value warning">DECLINING</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Troubleshooting Tips Section -->
    <div class="worksheet-section objectives-section">
      <h2 class="section-header"><i class="fas fa-lightbulb"></i> Troubleshooting Tips</h2>
      <div class="worksheet-content">
        <ul class="objectives-list">
          <li>Check valve sizing and flow characteristics vs system requirements</li>
          <li>Look for cavitation conditions and pressure drop issues</li>
          <li>Review PID controller tuning parameters and response curves</li>
          <li>Test valve response time and position accuracy</li>
        </ul>
      </div>
    </div>

    <!-- Investigation Tools Section -->
    <div class="worksheet-section tools-section">
      <h2 class="section-header"><i class="fas fa-tools"></i> Investigation Tools</h2>
      <div class="tools-content">
        <div class="tools-grid">
          <div class="tool-card" data-tool="analyze_valve_characteristics">
            <h4><i class="fas fa-valve"></i> Analyze Valve Flow Characteristics</h4>
            <p>Check valve sizing and flow characteristics vs system requirements</p>
            <button class="tool-btn" onclick="useTool('analyze_valve_characteristics')">Use Tool</button>
          </div>
          <div class="tool-card" data-tool="check_cavitation_conditions">
            <h4><i class="fas fa-water"></i> Check for Cavitation Conditions</h4>
            <p>Evaluate pressure drop and vapor pressure conditions</p>
            <button class="tool-btn" onclick="useTool('check_cavitation_conditions')">Use Tool</button>
          </div>
          <div class="tool-card" data-tool="review_controller_tuning">
            <h4><i class="fas fa-sliders-h"></i> Review Controller Tuning</h4>
            <p>Check PID parameters and control loop response</p>
            <button class="tool-btn" onclick="useTool('review_controller_tuning')">Use Tool</button>
          </div>
          <div class="tool-card" data-tool="monitor_temperature_effects">
            <h4><i class="fas fa-thermometer-half"></i> Monitor Temperature Effects</h4>
            <p>Analyze how brine temperature affects flow characteristics</p>
            <button class="tool-btn" onclick="useTool('monitor_temperature_effects')">Use Tool</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Investigation Results Section -->
    <div class="worksheet-section results-section" id="investigation-results" style="display: none;">
      <h2 class="section-header"><i class="fas fa-clipboard-list"></i> Investigation Results</h2>
      <div class="results-content" id="results-content">
        <!-- Results will be populated by JavaScript -->
      </div>
    </div>

    <!-- Simulation Section - COMMENTED OUT
    <div class="worksheet-section simulation-section">
      <h2 class="section-header"><i class="fas fa-cogs"></i> System Simulation</h2>
      <div class="worksheet-content">
        <div id="brine-flow-simulation" class="simulation-container">
          <div class="simulation-loading">
            <i class="fas fa-spinner fa-spin"></i>
            <p>Loading brine flow control simulation...</p>
          </div>
        </div>
        <div id="hmi-panel" class="simulation-container" style="margin-top: 20px;"></div>
        <div id="plc-io-panel" class="simulation-container" style="margin-top: 20px;"></div>
        <div id="fault-injection-panel" class="simulation-panel" style="margin-top: 20px;"></div>
        <div id="diagnostic-challenges-panel" class="simulation-panel" style="margin-top: 20px;"></div>
      </div>
    </div>
    -->

    <!-- Analysis Section -->
    <div class="worksheet-section questions-section">
      <h2 class="section-header"><i class="fas fa-clipboard-list"></i> Fault Analysis Worksheet</h2>
      <div class="questions-content">
        <div class="analysis-section">
          <h4>Observations:</h4>
          <textarea class="answer-input" data-question="observations" placeholder="Record your observations of the system behavior, readings, and any unusual indicators..."></textarea>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer('observations')">Save Observations</button>
          </div>
        </div>
        
        <div class="analysis-section">
          <h4>Problem:</h4>
          <textarea class="answer-input" data-question="problem" placeholder="Identify the root cause and describe the specific problem affecting the system..."></textarea>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer('problem')">Save Problem Analysis</button>
          </div>
        </div>
        
        <div class="analysis-section">
          <h4>Solution:</h4>
          <textarea class="answer-input" data-question="solution" placeholder="Describe the steps you would take to resolve the issue safely and effectively..."></textarea>
          <div class="question-actions">
            <button class="submit-question-btn" onclick="submitAnswer('solution')">Save Solution</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Simulation Scripts - COMMENTED OUT
  <script src="hmi-simulation.js"></script>
  <script src="plc-simulation.js"></script>
  <script src="valve-simulation.js"></script>
  <script src="pump-simulation.js"></script>
  -->
  <script>
    // Tool usage tracking
    let toolResults = {};
    
    function useTool(toolId) {
      const toolData = {
        'analyze_valve_characteristics': {
          title: 'Valve Flow Characteristics Analysis',
          content: 'Valve sizing analysis shows the control valve is oversized for the current flow range. Operating at 67% position indicates poor control resolution. Valve characteristic curve shows non-linear behavior in the operating range.',
          icon: 'fas fa-valve'
        },
        'check_cavitation_conditions': {
          title: 'Cavitation Analysis Results',
          content: 'Cavitation analysis reveals critical pressure drop conditions. With brine temperature at 45°C, the vapor pressure margin is reduced. Pressure drop across the valve exceeds the cavitation threshold, causing flow instability.',
          icon: 'fas fa-water'
        },
        'review_controller_tuning': {
          title: 'Controller Tuning Review',
          content: 'PID parameters show aggressive tuning with high proportional gain. This amplifies the flow variations caused by cavitation. Controller is responding to noise rather than actual process changes.',
          icon: 'fas fa-sliders-h'
        },
        'monitor_temperature_effects': {
          title: 'Temperature Effects Analysis',
          content: 'Temperature correlation analysis shows direct relationship between brine temperature and control instability. Higher temperatures reduce cavitation margin, causing more frequent valve hunting behavior.',
          icon: 'fas fa-thermometer-half'
        }
      };
      
      const result = toolData[toolId];
      if (result) {
        toolResults[toolId] = result;
        displayToolResult(toolId, result);
      }
    }
    
    function displayToolResult(toolId, result) {
      const resultsDiv = document.getElementById('tool-results');
      const resultHtml = `
        <div class="tool-result" id="result-${toolId}">
          <div class="result-header">
            <i class="${result.icon}"></i>
            <h3>${result.title}</h3>
          </div>
          <div class="result-content">
            <p>${result.content}</p>
          </div>
        </div>
      `;
      resultsDiv.innerHTML += resultHtml;
    }
    
    // Submit answer
    function submitAnswer(questionType) {
      const input = document.querySelector(`[data-question="${questionType}"]`);
      const answer = input.value.trim();
      
      if (answer) {
        localStorage.setItem(`fault5_${questionType}`, answer);
        
        const button = event.target;
        const originalText = button.textContent;
        button.textContent = 'Saved!';
        button.style.background = '#4CAF50';
        
        setTimeout(() => {
          button.textContent = originalText;
        }, 2000);
      } else {
        alert('Please enter content before saving.');
      }
    }

    // Load saved answers
    function loadSavedAnswers() {
      const questionTypes = ['observations', 'problem', 'solution'];
      questionTypes.forEach(type => {
        const saved = localStorage.getItem(`fault5_${type}`);
        if (saved) {
          const input = document.querySelector(`[data-question="${type}"]`);
          if (input) {
            input.value = saved;
          }
        }
      });
    }
    
    // Load saved answers on page load
    document.addEventListener('DOMContentLoaded', function() {
      loadSavedAnswers();
    });
  </script>
</body>
</html> 
